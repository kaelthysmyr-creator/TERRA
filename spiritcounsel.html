<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#060606">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>TERRA ‚Äî A Multicultural Journey</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;900&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;600&family=Noto+Serif+JP:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #060606; --nav-bg: rgba(0,0,0,0.92); --border: rgba(255,255,255,0.07);
  --text: #fff; --text-dim: rgba(255,255,255,0.4); --text-body: rgba(255,255,255,0.76);
  --card-bg: rgba(255,255,255,0.03); --stat-bg: rgba(255,255,255,0.05);
  --glyph-op: 0.06; --hero-glyph-op: 0.04; --accent: #ffffff;
  --modal-bg: rgba(0,0,0,0.95); --tts-active: #7fc46e;
}
[data-theme="light"] {
  --bg: #f5f5f7; --nav-bg: rgba(255,255,255,0.92); --border: rgba(0,0,0,0.1);
  --text: #1d1d1f; --text-dim: rgba(0,0,0,0.5); --text-body: rgba(0,0,0,0.8);
  --card-bg: #fff; --stat-bg: rgba(0,0,0,0.05);
  --glyph-op: 0.12; --hero-glyph-op: 0.08; --accent: #000000;
  --modal-bg: rgba(255,255,255,0.98);
}

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;height:100%;overflow:hidden;font-family:'DM Sans',sans-serif;background:var(--bg);color:var(--text);transition:background 0.3s, color 0.3s}

#nav{position:fixed;top:0;left:0;right:0;z-index:100;height:54px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;background:var(--nav-bg);backdrop-filter:blur(16px);border-bottom:1px solid var(--border)}
.logo{font-family:'Cinzel Decorative',serif;font-size:16px;font-weight:900;letter-spacing:4px;color:var(--text);flex-shrink:0}
#tab-bar{display:flex;gap:4px;overflow-x:auto;scrollbar-width:none;flex:1;justify-content:flex-start;padding:0 12px;margin:0 4px}
#tab-bar::-webkit-scrollbar{display:none}
.tab-btn{background:none;border:none;cursor:pointer;font-family:'DM Sans',sans-serif;font-size:10px;font-weight:600;letter-spacing:1.2px;text-transform:uppercase;color:var(--text-dim);padding:7px 11px;border-radius:18px;transition:all 0.3s;white-space:nowrap;display:flex;align-items:center;gap:4px;flex-shrink:0}
.tab-btn.active{color:var(--text);background:var(--stat-bg)}
.theme-toggle{background:none;border:none;cursor:pointer;font-size:18px;color:var(--text);padding:4px;display:flex;align-items:center}

/* TTS Controls */
.tts-controls{display:flex;align-items:center;gap:8px;margin-left:8px;padding-left:8px;border-left:1px solid var(--border)}
.tts-btn{background:var(--stat-bg);border:1px solid var(--border);color:var(--text);width:32px;height:32px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;transition:all 0.2s;position:relative}
.tts-btn:hover{background:var(--card-bg);transform:scale(1.1)}
.tts-btn.active{background:var(--tts-active);color:#000;border-color:var(--tts-active)}
.tts-btn.speaking::after{content:'';position:absolute;inset:-2px;border-radius:50%;border:2px solid var(--tts-active);animation:pulse 1.5s infinite}
.tts-lang{display:none;font-size:9px;text-transform:uppercase;opacity:0.7;margin-right:4px}

.speak-btn{display:inline-flex;align-items:center;gap:4px;background:var(--stat-bg);border:1px solid var(--border);color:var(--text);padding:4px 10px;border-radius:12px;font-size:10px;cursor:pointer;margin-top:8px;transition:all 0.2s}
.speak-btn:hover{background:var(--card-bg)}
.speak-btn.speaking{background:var(--tts-active);color:#000;border-color:var(--tts-active)}

#panels{position:fixed;top:54px;left:0;right:0;bottom:0;overflow:hidden}
.panel{position:absolute;inset:0;overflow-y:auto;opacity:0;pointer-events:none;transition:opacity 0.45s ease}
.panel.active{opacity:1;pointer-events:all}
.panel::-webkit-scrollbar{width:3px}
.panel::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.15);border-radius:2px}

.hero{min-height:52vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative;padding:50px 20px 36px;overflow:hidden}
.hero-bg-glyph{position:absolute;font-size:clamp(130px,38vw,260px);opacity:var(--hero-glyph-op);z-index:0;animation:floatY 8s ease-in-out infinite}
.hero-title{font-family:'Cinzel Decorative',serif;font-size:clamp(24px,8vw,62px);font-weight:900;margin-bottom:13px;position:relative;z-index:2}
.hero-sub{font-family:'Playfair Display',serif;font-style:italic;font-size:clamp(13px,3vw,18px);opacity:0.7;max-width:560px;position:relative;z-index:2}

.grid{display:grid;grid-template-columns:1fr;gap:13px;max-width:840px;margin:0 auto;padding:0 13px 70px}
@media(min-width:560px){.grid{grid-template-columns:1fr 1fr}}

.sec-label{grid-column:1/-1;font-family:'Cinzel Decorative',serif;font-size:9px;letter-spacing:3px;text-transform:uppercase;opacity:0.3;padding:16px 0 4px;border-top:1px solid var(--border);margin-top:4px}
.card{border-radius:13px;padding:20px;position:relative;overflow:hidden;border:1px solid var(--border);background:var(--card-bg);transition:transform 0.2s}
.card:active{transform:scale(0.985)}
.card.wide,.card.full{grid-column:1/-1}
.card-tag{font-size:9px;letter-spacing:2px;text-transform:uppercase;font-weight:700;margin-bottom:7px;opacity:0.6;display:flex;align-items:center;justify-content:space-between}
.card-title{font-family:'Playfair Display',serif;font-size:clamp(15px,3.5vw,21px);font-weight:700;margin-bottom:8px}
.card-body{font-size:13px;line-height:1.68;opacity:0.76;color:var(--text-body)}

.expandable .card-body{max-height:100px;overflow:hidden;transition:max-height 0.4s ease}
.expandable.open .card-body{max-height:none}
.expand-btn{background:none;border:none;cursor:pointer;font-size:10px;text-transform:uppercase;margin-top:12px;font-weight:700;opacity:0.6;display:block}

.spirit-box{background:linear-gradient(135deg, var(--stat-bg), transparent);border:1px solid var(--border);border-radius:15px;padding:15px;margin-top:10px;display:flex;align-items:center;gap:15px}
.spirit-icon{font-size:40px;filter:drop-shadow(0 0 10px var(--accent))}
.spirit-info{font-size:11px;font-style:italic;opacity:0.8}

.food-scroll{display:flex;gap:12px;overflow-x:auto;padding-bottom:12px;scrollbar-width:none;-webkit-overflow-scrolling:touch}
.food-item{min-width:110px;text-align:center;flex-shrink:0;background:var(--stat-bg);padding:12px 8px;border-radius:12px;border:1px solid var(--border);cursor:pointer;transition:all 0.3s;position:relative}
.food-item:hover{background:var(--card-bg);transform:translateY(-2px)}
.food-item:active{transform:scale(0.95)}
.food-emoji{font-size:32px;display:block;margin-bottom:6px}
.food-name{font-size:11px;font-weight:700;display:block;margin-bottom:2px}

.timeline{list-style:none;padding:0}
.timeline li{padding:9px 0 9px 20px;border-left:2px solid var(--border);position:relative;font-size:12.5px}
.timeline li::before{content:'';position:absolute;left:-5px;top:16px;width:8px;height:8px;border-radius:50%;background:currentColor}
.timeline .yr{font-weight:700;font-size:10px;opacity:0.5;display:block}

.ticker-wrap{grid-column:1/-1;overflow:hidden;border-radius:11px;background:var(--card-bg);border:1px solid var(--border);padding:11px 16px}
.ticker-inner{display:inline-block;animation:tick 25s linear infinite;font-family:'Playfair Display',serif;font-style:italic;font-size:13.5px}

.quiz-opts{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-top:10px}
.quiz-opt{padding:10px 9px;border-radius:9px;border:1px solid var(--border);background:var(--card-bg);cursor:pointer;font-size:11.5px;color:inherit}
.quiz-opt.correct{background:rgba(60,200,60,0.18);border-color:#3c3}
.quiz-opt.wrong{background:rgba(200,60,60,0.18);border-color:#c33}
.quiz-next{margin-top:11px;padding:8px 18px;border-radius:16px;border:none;cursor:pointer;font-size:10px;font-weight:700;display:none;background:var(--stat-bg);color:var(--text)}
.quiz-progress{font-size:11px;opacity:0.6;margin-bottom:10px;font-style:italic}
.quiz-score{font-size:24px;font-family:'Cinzel Decorative',serif;text-align:center;margin:20px 0}
.quiz-restart{margin-top:15px;padding:10px 24px;border-radius:20px;border:none;cursor:pointer;font-size:11px;font-weight:700;background:var(--stat-bg);color:var(--text);display:block;margin-left:auto;margin-right:auto}

/* Food Modal Styles */
.food-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--modal-bg);z-index:200;display:none;align-items:flex-end;justify-content:center;padding:0;backdrop-filter:blur(10px)}
.food-modal.active{display:flex}
.food-modal-content{background:var(--card-bg);border:1px solid var(--border);border-radius:20px 20px 0 0;max-width:500px;width:100%;max-height:70vh;overflow-y:auto;padding:30px 25px 40px;position:relative;animation:slideUp 0.3s ease;margin:0 auto}
.food-modal-close{position:absolute;top:15px;right:15px;background:none;border:none;font-size:24px;cursor:pointer;color:var(--text);opacity:0.6;transition:opacity 0.2s;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%}
.food-modal-close:hover{opacity:1;background:var(--stat-bg)}
.food-modal-emoji{font-size:50px;text-align:center;margin-bottom:10px;margin-top:10px}
.food-modal-title{font-family:'Cinzel Decorative',serif;font-size:22px;text-align:center;margin-bottom:20px;color:var(--text);padding:0 20px}
.food-modal-history{font-size:13px;line-height:1.8;color:var(--text-body);text-align:left}
.food-modal-history p{margin-bottom:12px}
.food-modal-backdrop{position:absolute;inset:0;background:transparent;z-index:-1}

@keyframes tick{0%{transform:translateX(100vw)}100%{transform:translateX(-100%)}}
@keyframes floatY{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
@keyframes pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.1);opacity:0.5}}

#panel-irish{background:radial-gradient(ellipse at top,#182f16 0%,var(--bg) 70%)}
#panel-irish .hero-title, #panel-irish .card-tag, #panel-irish .sec-label, #panel-irish .expand-btn, #panel-irish .food-modal-title{color:#7fc46e;--tts-active:#7fc46e}
#panel-portuguese{background:radial-gradient(ellipse at top left,#200a0a 0%,var(--bg) 70%)}
#panel-portuguese .hero-title, #panel-portuguese .card-tag, #panel-portuguese .sec-label, #panel-portuguese .expand-btn, #panel-portuguese .food-modal-title{color:#e05a45;--tts-active:#e05a45}
#panel-japanese{background:radial-gradient(ellipse at top right,#140810 0%,var(--bg) 70%)}
#panel-japanese .hero-title, #panel-japanese .card-tag, #panel-japanese .sec-label, #panel-japanese .expand-btn, #panel-japanese .food-modal-title{color:#e8a0b5;--tts-active:#e8a0b5}
#panel-moroccan{background:radial-gradient(ellipse at bottom,#1e0e00 0%,var(--bg) 70%)}
#panel-moroccan .hero-title, #panel-moroccan .card-tag, #panel-moroccan .sec-label, #panel-moroccan .expand-btn, #panel-moroccan .food-modal-title{color:#e89020;--tts-active:#e89020}
#panel-mexican{background:radial-gradient(ellipse at top,#120a1a 0%,var(--bg) 70%)}
#panel-mexican .hero-title, #panel-mexican .card-tag, #panel-mexican .sec-label, #panel-mexican .expand-btn, #panel-mexican .food-modal-title{color:#f0a030;--tts-active:#f0a030}
#panel-american{background:radial-gradient(ellipse at top,#0a1420 0%,var(--bg) 70%)}
#panel-american .hero-title, #panel-american .card-tag, #panel-american .sec-label, #panel-american .expand-btn, #panel-american .food-modal-title{color:#4a90e2;--tts-active:#4a90e2}
#panel-russian{background:radial-gradient(ellipse at top,#1a0505 0%,var(--bg) 70%)}
#panel-russian .hero-title, #panel-russian .card-tag, #panel-russian .sec-label, #panel-russian .expand-btn, #panel-russian .food-modal-title{color:#c41e3a;--tts-active:#c41e3a}
#panel-fantasy{background:radial-gradient(ellipse at top,#0f1f0f 0%,var(--bg) 70%)}
#panel-fantasy .hero-title, #panel-fantasy .card-tag, #panel-fantasy .sec-label, #panel-fantasy .expand-btn, #panel-fantasy .food-modal-title{color:#8fbc8f;--tts-active:#8fbc8f}
#panel-vulcan{background:radial-gradient(ellipse at top,#1a1510 0%,var(--bg) 70%)}
#panel-vulcan .hero-title, #panel-vulcan .card-tag, #panel-vulcan .sec-label, #panel-vulcan .expand-btn, #panel-vulcan .food-modal-title{color:#cd7f32;--tts-active:#cd7f32}
#panel-candy{background:radial-gradient(ellipse at top,#2a0f1a 0%,var(--bg) 70%)}
#panel-candy .hero-title, #panel-candy .card-tag, #panel-candy .sec-label, #panel-candy .expand-btn, #panel-candy .food-modal-title{color:#ff69b4;--tts-active:#ff69b4}
#panel-egyptian{background:radial-gradient(ellipse at top,#2a2005 0%,var(--bg) 70%)}
#panel-egyptian .hero-title, #panel-egyptian .card-tag, #panel-egyptian .sec-label, #panel-egyptian .expand-btn, #panel-egyptian .food-modal-title{color:#d4af37;--tts-active:#d4af37}

/* TTS Highlight effect */
.tts-highlight{background:rgba(127,196,110,0.2);border-radius:2px;transition:background 0.3s}

/* ============================================
   UNIFORM HOVER & PARALLAX EFFECTS
   ============================================ */

/* 1. 3D Tilt Cards with Dynamic Glare */
.card, .food-item {
  transform-style: preserve-3d;
  transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1), box-shadow 0.3s ease;
  will-change: transform;
}

.tilt-card {
  position: relative;
  overflow: hidden;
}

.tilt-card::before {
  content: '';
  position: absolute;
  top: -50%; left: -50%; width: 200%; height: 200%;
  background: radial-gradient(
    circle at var(--glare-x, 50%) var(--glare-y, 50%),
    rgba(255,255,255,0.15) 0%,
    rgba(255,255,255,0) 60%
  );
  opacity: 0;
  transition: opacity 0.3s;
  pointer-events: none;
  z-index: 10;
}

.tilt-card:hover::before {
  opacity: 1;
}

/* 2. Scroll Reveal Animations */
.reveal-element {
  opacity: 0;
  transform: translateY(30px) scale(0.95);
  transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), 
              transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
}

.reveal-element.revealed {
  opacity: 1;
  transform: translateY(0) scale(1);
}

.reveal-delay-1 { transition-delay: 0.1s; }
.reveal-delay-2 { transition-delay: 0.2s; }
.reveal-delay-3 { transition-delay: 0.3s; }
.reveal-delay-4 { transition-delay: 0.4s; }
.reveal-delay-5 { transition-delay: 0.5s; }

/* 3. Parallax Hero Layers */
.hero {
  position: relative;
  overflow: hidden;
}

.hero-bg-glyph {
  will-change: transform, opacity;
  transform: translateZ(0);
}

.hero-title {
  will-change: transform, opacity;
}

/* 4. Magnetic Buttons */
.magnetic-btn {
  transition: transform 0.3s cubic-bezier(0.23, 1, 0.32, 1);
  position: relative;
  z-index: 10;
}

/* 5. Cultural Neon Glows */
#panel-irish .card:hover, #panel-irish .food-item:hover, #panel-irish .quiz-opt:not(.correct):not(.wrong):hover {
  box-shadow: 0 0 30px rgba(127, 196, 110, 0.3), 0 4px 20px rgba(0,0,0,0.3);
  border-color: rgba(127, 196, 110, 0.5);
  transform: translateY(-2px);
}

#panel-portuguese .card:hover, #panel-portuguese .food-item:hover, #panel-portuguese .quiz-opt:not(.correct):not(.wrong):hover {
  box-shadow: 0 0 30px rgba(224, 90, 69, 0.3), 0 4px 20px rgba(0,0,0,0.3);
  border-color: rgba(224, 90, 69, 0.5);
  transform: translateY(-2px);
}

#panel-japanese .card:hover, #panel-japanese .food-item:hover, #panel-japanese .quiz-opt:not(.correct):not(.wrong):hover {
  box-shadow: 0 0 30px rgba(232, 160, 181, 0.3), 0 4px 20px rgba(0,0,0,0.3);
  border-color: rgba(232, 160, 181, 0.5);
  transform: translateY(-2px);
}

#panel-moroccan .card:hover, #panel-moroccan .food-item:hover, #panel-moroccan .quiz-opt:not(.correct):not(.wrong):hover {
  box-shadow: 0 0 30px rgba(232, 144, 32, 0.3), 0 4px 20px rgba(0,0,0,0.3);
  border-color: rgba(232, 144, 32, 0.5);
  transform: translateY(-2px);
}

#panel-mexican .card:hover, #panel-mexican .food-item:hover, #panel-mexican .quiz-opt:not(.correct):not(.wrong):hover {
  box-shadow: 0 0 30px rgba(240, 160, 48, 0.3), 0 4px 20px rgba(0,0,0,0.3);
  border-color: rgba(240, 160, 48, 0.5);
  transform: translateY(-2px);
}

#panel-american .card:hover, #panel-american .food-item:hover, #panel-american .quiz-opt:not(.correct):not(.wrong):hover {
  box-shadow: 0 0 30px rgba(74, 144, 226, 0.3), 0 4px 20px rgba(0,0,0,0.3);
  border-color: rgba(74, 144, 226, 0.5);
  transform: translateY(-2px);
}

#panel-russian .card:hover, #panel-russian .food-item:hover, #panel-russian .quiz-opt:not(.correct):not(.wrong):hover {
  box-shadow: 0 0 30px rgba(196, 30, 58, 0.3), 0 4px 20px rgba(0,0,0,0.3);
  border-color: rgba(196, 30, 58, 0.5);
  transform: translateY(-2px);
}

#panel-egyptian .card:hover, #panel-egyptian .food-item:hover, #panel-egyptian .quiz-opt:not(.correct):not(.wrong):hover {
  box-shadow: 0 0 30px rgba(212, 175, 55, 0.3), 0 4px 20px rgba(0,0,0,0.3);
  border-color: rgba(212, 175, 55, 0.5);
  transform: translateY(-2px);
}

#panel-fantasy .card:hover, #panel-fantasy .food-item:hover, #panel-fantasy .quiz-opt:not(.correct):not(.wrong):hover {
  box-shadow: 0 0 30px rgba(143, 188, 143, 0.3), 0 4px 20px rgba(0,0,0,0.3);
  border-color: rgba(143, 188, 143, 0.5);
  transform: translateY(-2px);
}

#panel-vulcan .card:hover, #panel-vulcan .food-item:hover, #panel-vulcan .quiz-opt:not(.correct):not(.wrong):hover {
  box-shadow: 0 0 30px rgba(205, 127, 50, 0.3), 0 4px 20px rgba(0,0,0,0.3);
  border-color: rgba(205, 127, 50, 0.5);
  transform: translateY(-2px);
}

#panel-candy .card:hover, #panel-candy .food-item:hover, #panel-candy .quiz-opt:not(.correct):not(.wrong):hover {
  box-shadow: 0 0 30px rgba(255, 105, 180, 0.3), 0 4px 20px rgba(0,0,0,0.3);
  border-color: rgba(255, 105, 180, 0.5);
  transform: translateY(-2px);
}

/* Tab Hover Enhancements */
.tab-btn {
  position: relative;
  overflow: hidden;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.tab-btn::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 0;
  height: 2px;
  background: currentColor;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateX(-50%);
  opacity: 0.7;
}

.tab-btn:hover::after {
  width: 80%;
}

.tab-btn:hover:not(.active) {
  background: var(--card-bg);
  transform: translateY(-1px);
}

/* Text Decode Effect Styles */
.decode-target {
  display: inline-block;
  min-width: 1em;
}

/* Cursor Trail */
.cursor-trail {
  position: fixed;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  pointer-events: none;
  z-index: 9999;
  opacity: 0;
  transition: opacity 0.3s;
  mix-blend-mode: screen;
  filter: blur(4px);
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
  .reveal-element {
    opacity: 1;
    transform: none;
    transition: none;
  }
  .tilt-card, .card, .food-item {
    transform: none !important;
    transition: none !important;
  }
  .cursor-trail {
    display: none;
  }
}

/* Mobile optimizations */
@media (max-width: 768px) {
  .card:hover {
    transform: translateY(-2px) !important;
  }
  .cursor-trail {
    display: none;
  }
}

/* ============================================
   NEW BACKGROUND ENHANCEMENTS
   ============================================ */

/* 1. CULTURAL PARTICLE ATMOSPHERES */
.particle-canvas {
  position: fixed;
  top: 54px;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 1;
  opacity: 0.4;
}

/* 2. LIVING TEXTURE MORPHING */
.texture-layer {
  position: fixed;
  top: 54px;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0.03;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
  animation: textureBreathe 8s ease-in-out infinite;
}

@keyframes textureBreathe {
  0%, 100% { transform: scale(1); opacity: 0.03; }
  50% { transform: scale(1.02); opacity: 0.05; }
}

/* Seasonal shifts for specific cultures */
#panel-irish .texture-layer {
  background: radial-gradient(circle at 50% 50%, rgba(127, 196, 110, 0.1), transparent 70%);
  animation: irishMist 12s ease-in-out infinite;
}

@keyframes irishMist {
  0%, 100% { opacity: 0.02; transform: translateY(0); }
  50% { opacity: 0.06; transform: translateY(-10px); }
}

#panel-japanese .texture-layer {
  background: radial-gradient(circle at 80% 20%, rgba(232, 160, 181, 0.15), transparent 60%);
}

/* 3. CONSTELLATION CONNECTION NETWORKS */
.constellation-svg {
  position: fixed;
  top: 54px;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 1;
  opacity: 0.15;
}

.constellation-line {
  stroke: currentColor;
  stroke-width: 0.5;
  fill: none;
  stroke-dasharray: 100;
  stroke-dashoffset: 100;
  animation: drawLine 3s ease-out forwards;
}

@keyframes drawLine {
  to { stroke-dashoffset: 0; }
}

.constellation-node {
  fill: currentColor;
  r: 2;
  opacity: 0.6;
  animation: pulseNode 4s ease-in-out infinite;
}

@keyframes pulseNode {
  0%, 100% { opacity: 0.3; r: 1.5; }
  50% { opacity: 0.8; r: 2.5; }
}

/* 4. PARALLAX DEPTH PLANES */
.parallax-layer {
  position: absolute;
  left: 0;
  right: 0;
  pointer-events: none;
  z-index: 0;
  will-change: transform;
}

.parallax-deep {
  top: 0;
  height: 120%;
  background: inherit;
  filter: brightness(0.3);
  z-index: -2;
}

.parallax-mid {
  top: 10%;
  height: 100%;
  opacity: 0.05;
  z-index: -1;
  background-repeat: repeat;
  background-size: 100px 100px;
}

.parallax-near {
  top: 20%;
  height: 80%;
  background: linear-gradient(to bottom, transparent, var(--bg));
  z-index: 0;
  opacity: 0.8;
}

/* Culture-specific mid-layer patterns */
#panel-irish .parallax-mid {
  background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20,20 Q40,5 60,20 T100,20 M20,60 Q40,45 60,60 T100,60' stroke='%237fc46e' fill='none' stroke-width='0.5'/%3E%3C/svg%3E");
}

#panel-japanese .parallax-mid {
  background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='30' cy='30' r='1' fill='%23e8a0b5'/%3E%3C/svg%3E");
}

#panel-egyptian .parallax-mid {
  background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M40,10 L50,40 L40,35 L30,40 Z' fill='%23d4af37' opacity='0.3'/%3E%3C/svg%3E");
}

/* 5. TEMPORAL LIGHTING SHIFTS */
.temporal-overlay {
  position: fixed;
  top: 54px;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 2;
  opacity: 0.3;
  mix-blend-mode: overlay;
  animation: temporalShift 20s ease-in-out infinite;
  background: radial-gradient(circle at 30% 30%, var(--lighting-color, rgba(255,200,100,0.2)), transparent 70%);
}

#panel-moroccan .temporal-overlay {
  --lighting-color: rgba(232, 144, 32, 0.3);
  animation: moroccanSunset 25s ease-in-out infinite;
}

#panel-irish .temporal-overlay {
  --lighting-color: rgba(127, 196, 110, 0.15);
  animation: irishFog 15s ease-in-out infinite;
}

#panel-russian .temporal-overlay {
  --lighting-color: rgba(196, 30, 58, 0.1);
  animation: russianWinter 30s ease-in-out infinite;
}

@keyframes temporalShift {
  0%, 100% { transform: translateX(-10%) translateY(-10%); opacity: 0.2; }
  50% { transform: translateX(10%) translateY(10%); opacity: 0.4; }
}

@keyframes moroccanSunset {
  0% { background: radial-gradient(circle at 20% 80%, rgba(232, 144, 32, 0.4), transparent 70%); }
  50% { background: radial-gradient(circle at 80% 20%, rgba(100, 50, 150, 0.3), transparent 70%); }
  100% { background: radial-gradient(circle at 20% 80%, rgba(232, 144, 32, 0.4), transparent 70%); }
}

@keyframes irishFog {
  0%, 100% { opacity: 0.1; filter: blur(0px); }
  50% { opacity: 0.3; filter: blur(2px); }
}

@keyframes russianWinter {
  0%, 100% { background: radial-gradient(circle at 50% 0%, rgba(200, 220, 255, 0.2), transparent 70%); opacity: 0.2; }
  50% { background: radial-gradient(circle at 50% 100%, rgba(196, 30, 58, 0.1), transparent 70%); opacity: 0.3; }
}

/* Water caustics for coastal cultures */
.water-caustics {
  position: fixed;
  top: 54px;
  left: 0;
  right: 0;
  bottom: 0;
  pointer-events: none;
  z-index: 1;
  opacity: 0.05;
  background: repeating-linear-gradient(
    90deg,
    transparent,
    transparent 50px,
    rgba(255,255,255,0.03) 50px,
    rgba(255,255,255,0.03) 100px
  );
  animation: causticShift 10s linear infinite;
  mask-image: linear-gradient(to bottom, transparent, black 80%);
  -webkit-mask-image: linear-gradient(to bottom, transparent, black 80%);
}

@keyframes causticShift {
  0% { transform: translateX(-100px); }
  100% { transform: translateX(100px); }
}

/* Candy Kingdom iridescence */
#panel-candy .temporal-overlay {
  background: linear-gradient(45deg, rgba(255,105,180,0.1), rgba(100,200,255,0.1), rgba(255,255,100,0.1));
  background-size: 200% 200%;
  animation: candyIridescence 8s ease infinite;
}

@keyframes candyIridescence {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Vulcan heat shimmer */
#panel-vulcan .temporal-overlay {
  background: repeating-linear-gradient(
    0deg,
    transparent,
    rgba(205, 127, 50, 0.1) 10px,
    transparent 20px
  );
  animation: heatShimmer 3s linear infinite;
  opacity: 0.2;
}

@keyframes heatShimmer {
  0% { transform: translateY(0); }
  100% { transform: translateY(20px); }
}

/* Enhanced grid positioning for new layers */
.grid {
  position: relative;
  z-index: 10;
}

.hero {
  z-index: 5;
}

/* Mobile performance */
@media (max-width: 768px) {
  .particle-canvas,
  .constellation-svg,
  .temporal-overlay,
  .texture-layer,
  .parallax-mid {
    display: none;
  }
}

/* Chat System Specific Styles */
.chat-card {
  position: relative;
  overflow: visible;
}
.chat-card::before {
  content: '';
  position: absolute;
  top: -1px; left: -1px; right: -1px; bottom: -1px;
  background: linear-gradient(135deg, var(--tts-active) 0%, transparent 50%);
  border-radius: 14px;
  z-index: -1;
  opacity: 0.1;
  pointer-events: none;
}
@keyframes chat-bounce {
  0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
  40% { transform: scale(1); opacity: 1; }
}
@keyframes chat-fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
.chat-message {
  transition: opacity 0.3s ease;
  animation: chat-fadeIn 0.3s ease;
}
</style>
</head>
<body>

<nav id="nav">
  <div class="logo">TERRA</div>
  <div id="tab-bar">
    <button class="tab-btn active" onclick="showTab('irish',this)">üçÄ Ireland</button>
    <button class="tab-btn" onclick="showTab('portuguese',this)">üáµüáπ Portugal</button>
    <button class="tab-btn" onclick="showTab('japanese',this)">üáØüáµ Japan</button>
    <button class="tab-btn" onclick="showTab('moroccan',this)">üá≤üá¶ Morocco</button>
    <button class="tab-btn" onclick="showTab('mexican',this)">üá≤üáΩ Mexico</button>
    <button class="tab-btn" onclick="showTab('american',this)">üá∫üá∏ USA</button>
    <button class="tab-btn" onclick="showTab('russian',this)">üá∑üá∫ Russia</button>
    <button class="tab-btn" onclick="showTab('egyptian',this)">üá™üá¨ Egypt</button>
    <button class="tab-btn" onclick="showTab('fantasy',this)">üßô‚Äç‚ôÇÔ∏è The Shire</button>
    <button class="tab-btn" onclick="showTab('vulcan',this)">üññ Vulcan</button>
    <button class="tab-btn" onclick="showTab('candy',this)">üç¨ Candy Kingdom</button>
  </div>
  <div class="tts-controls">
    <span class="tts-lang" id="ttsLang">EN</span>
    <button class="tts-btn" id="ttsToggle" onclick="toggleTTS()" title="Text to Speech">üîä</button>
    <button class="tts-btn" id="ttsStop" onclick="stopSpeaking()" title="Stop Speaking" style="display:none">‚èπ</button>
  </div>
  <button class="theme-toggle" onclick="toggleTheme()">üåì</button>
</nav>

<div id="panels">
  <div class="panel active" id="panel-irish"></div>
  <div class="panel" id="panel-portuguese"></div>
  <div class="panel" id="panel-japanese"></div>
  <div class="panel" id="panel-moroccan"></div>
  <div class="panel" id="panel-mexican"></div>
  <div class="panel" id="panel-american"></div>
  <div class="panel" id="panel-russian"></div>
  <div class="panel" id="panel-egyptian"></div>
  <div class="panel" id="panel-fantasy"></div>
  <div class="panel" id="panel-vulcan"></div>
  <div class="panel" id="panel-candy"></div>
</div>

<div class="food-modal" id="foodModal" onclick="closeFoodModal(event)">
  <div class="food-modal-backdrop"></div>
  <div class="food-modal-content" onclick="event.stopPropagation()">
    <button class="food-modal-close" onclick="closeFoodModal()">√ó</button>
    <div class="food-modal-emoji" id="modalEmoji"></div>
    <div class="food-modal-title" id="modalTitle"></div>
    <div class="food-modal-history" id="modalHistory"></div>
    <button class="speak-btn" id="modalSpeakBtn" onclick="speakModalContent()">üîä Read Aloud</button>
  </div>
</div>

<script>
// TTS State
let ttsEnabled = true;
let currentUtterance = null;
let currentLang = 'en-US';

// Language mapping for TTS
const langMap = {
  irish: 'en-IE',
  portuguese: 'pt-PT',
  japanese: 'ja-JP',
  moroccan: 'en-US',
  mexican: 'es-MX',
  american: 'en-US',
  russian: 'ru-RU',
  egyptian: 'ar-EG',
  fantasy: 'en-GB',
  vulcan: 'en-US',
  candy: 'en-US'
};

const langNames = {
  irish: 'EN-IE',
  portuguese: 'PT',
  japanese: 'JP',
  moroccan: 'EN',
  mexican: 'ES',
  american: 'EN',
  russian: 'RU',
  egyptian: 'AR',
  fantasy: 'GB',
  vulcan: 'VU',
  candy: 'CK'
};

// Store food data globally
var FoodData = {};
var CurrentModalData = null;

function toggleTheme(){
  const b=document.body; b.setAttribute('data-theme', b.getAttribute('data-theme')==='light'?'dark':'light');
}

function showTab(id,btn){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('panel-'+id).classList.add('active'); 
  btn.classList.add('active');
  
  // Update TTS language
  currentLang = langMap[id] || 'en-US';
  document.getElementById('ttsLang').textContent = langNames[id] || 'EN';
  stopSpeaking();
  
  // Refresh visual effects for new panel
  setTimeout(() => {
    initializeVisualEffects();
  }, 100);
}

function toggleCard(card){
  card.classList.toggle('open');
  const btn=card.querySelector('.expand-btn');
  if(btn) btn.textContent=card.classList.contains('open')?'Show Less ‚Üë':'Read More ‚Üì';
}

// TTS Functions
function toggleTTS(){
  ttsEnabled = !ttsEnabled;
  document.getElementById('ttsToggle').classList.toggle('active', ttsEnabled);
  if(!ttsEnabled) stopSpeaking();
}

function speak(text, lang = null, btnElement = null){
  if(!ttsEnabled || !window.speechSynthesis) return;
  
  stopSpeaking();
  
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = lang || currentLang;
  utterance.rate = 0.9;
  utterance.pitch = 1;
  
  if(btnElement){
    btnElement.classList.add('speaking');
    utterance.onend = () => btnElement.classList.remove('speaking');
  }
  
  // Visual feedback
  document.getElementById('ttsToggle').classList.add('speaking');
  document.getElementById('ttsStop').style.display = 'flex';
  
  utterance.onend = () => {
    document.getElementById('ttsToggle').classList.remove('speaking');
    document.getElementById('ttsStop').style.display = 'none';
    if(btnElement) btnElement.classList.remove('speaking');
  };
  
  utterance.onerror = () => {
    document.getElementById('ttsToggle').classList.remove('speaking');
    document.getElementById('ttsStop').style.display = 'none';
    if(btnElement) btnElement.classList.remove('speaking');
  };
  
  currentUtterance = utterance;
  window.speechSynthesis.speak(utterance);
}

function stopSpeaking(){
  if(window.speechSynthesis){
    window.speechSynthesis.cancel();
  }
  document.getElementById('ttsToggle').classList.remove('speaking');
  document.getElementById('ttsStop').style.display = 'none';
  document.querySelectorAll('.speaking').forEach(el => el.classList.remove('speaking'));
  currentUtterance = null;
}

function speakSection(sectionType, culture){
  const panel = document.getElementById('panel-' + culture);
  let text = '';
  
  switch(sectionType){
    case 'spirit':
      const spiritTitle = panel.querySelector('.spirit-info strong').textContent;
      const spiritDesc = panel.querySelector('.spirit-info').textContent.replace(spiritTitle, '');
      text = spiritTitle + '. ' + spiritDesc;
      break;
    case 'folklore':
      text = panel.querySelector('.expandable .card-body').textContent;
      break;
    case 'architecture':
      const archCards = panel.querySelectorAll('.expandable');
      if(archCards[1]) text = archCards[1].querySelector('.card-body').textContent;
      break;
    case 'techniques':
      const techCards = panel.querySelectorAll('.expandable');
      if(techCards[2]) text = techCards[2].querySelector('.card-body').textContent;
      break;
  }
  
  if(text) speak(text);
}

function speakModalContent(){
  if(!CurrentModalData) return;
  const text = CurrentModalData.n + '. ' + CurrentModalData.h.replace(/<[^>]*>/g, ' ');
  const btn = document.getElementById('modalSpeakBtn');
  speak(text, null, btn);
}

function openFoodModal(foodKey){
  const data = FoodData[foodKey];
  if(!data) return;
  
  CurrentModalData = data;
  document.getElementById('modalEmoji').textContent = data.e;
  document.getElementById('modalTitle').textContent = data.n;
  document.getElementById('modalHistory').innerHTML = data.h;
  document.getElementById('foodModal').classList.add('active');
  document.getElementById('modalSpeakBtn').classList.remove('speaking');
  document.body.style.overflow = 'hidden';
  
  // Auto-speak if TTS enabled
  if(ttsEnabled){
    setTimeout(() => speakModalContent(), 300);
  }
}

function closeFoodModal(e){
  if(e && e.target !== document.getElementById('foodModal') && !e.target.classList.contains('food-modal-close') && !e.target.classList.contains('food-modal-backdrop')) return;
  document.getElementById('foodModal').classList.remove('active');
  document.body.style.overflow = '';
  stopSpeaking();
}

// Quiz Data
var QS={};
var QD={
  irish:[
    {q:"Land of the Young?",opts:["Puca","T√≠r na n√ìg","Banshee","Cailleach"],a:1},
    {q:"Dry stone fort?",opts:["Cashel","Crannog","Dolmen","Ogham"],a:0},
    {q:"Symbol associated with St. Patrick?",opts:["Thistle","Shamrock","Daffodil","Rose"],a:1},
    {q:"Traditional Irish language?",opts:["Gaeilge","Erse","Gallic","Celtic"],a:0},
    {q:"Who wrote Ulysses?",opts:["Yeats","Joyce","Beckett","Wilde"],a:1},
    {q:"Traditional music gathering?",opts:["C√®ilidh","Hootenanny","Jam","Festival"],a:0},
    {q:"County known as 'The Kingdom'?",opts:["Cork","Dublin","Kerry","Galway"],a:2},
    {q:"What does 'Sl√°inte' mean?",opts:["Cheers/Health","Goodbye","Hello","Food"],a:0},
    {q:"National symbol instrument?",opts:["Bagpipes","Harp","Fiddle","Bodhr√°n"],a:1},
    {q:"Ancient alphabet on stones?",opts:["Runes","Ogham","Cuneiform","Hieroglyphs"],a:1}
  ],
  portuguese:[
    {q:"Manueline motifs?",opts:["Gargoyles","Ropes/Coral","Glass","Steel"],a:1},
    {q:"Portuguese egg tart?",opts:["Pastel Nata","Bacalhau","Caldo Verde","Polvo"],a:0},
    {q:"Traditional melancholic music?",opts:["Flamenco","Fado","Samba","Tango"],a:1},
    {q:"Explorer who found sea route to India?",opts:["Columbus","Magellan","Vasco da Gama","Cabral"],a:2},
    {q:"Capital of Portugal?",opts:["Lisbon","Porto","Faro","Coimbra"],a:0},
    {q:"Fortified wine with brandy?",opts:["Sherry","Port","Madeira","Vinho Verde"],a:1},
    {q:"Meaning of 'Saudade'?",opts:["Joy","Longing","Anger","Hunger"],a:1},
    {q:"Autonomous Atlantic archipelago?",opts:["Canary","Azores","Balearic","Cyclades"],a:1},
    {q:"Traditional grilled sardines?",opts:["Sardinhas Assadas","Caldeirada","Cataplana","Feijoada"],a:0},
    {q:"Famous Bel√©m tower style?",opts:["Baroque","Manueline","Rococo","Neoclassical"],a:1}
  ],
  japanese:[
    {q:"Trickster fox spirits?",opts:["Tengu","Kappa","Kitsune","Tanuki"],a:2},
    {q:"Fermented soybean paste?",opts:["Shoyu","Miso","Mirin","Dashi"],a:1},
    {q:"Traditional New Year rice cake?",opts:["Onigiri","Mochi","Tempura","Udon"],a:1},
    {q:"Paper folding art?",opts:["Ikebana","Origami","Bonsai","Sumi-e"],a:1},
    {q:"Japanese tea ceremony?",opts:["Chanoyu","Kabuki","Kaiseki","Obon"],a:0},
    {q:"Former name of Tokyo?",opts:["Kyoto","Osaka","Edo","Nara"],a:2},
    {q:"Traditional Japanese inn?",opts:["Hotel","Ryokan","Hostel","Minshuku"],a:1},
    {q:"Samurai curved sword?",opts:["Katana","Wakizashi","Tanto","Naginata"],a:0},
    {q:"Meaning of 'Kawaii'?",opts:["Scary","Cute","Delicious","Fast"],a:1},
    {q:"National flower symbol?",opts:["Ume","Sakura","Chrysanthemum","Hibiscus"],a:1}
  ],
  moroccan:[
    {q:"Courtyard house?",opts:["Kasbah","Riad","Medina","Zellige"],a:1},
    {q:"Slow-cooked clay pot dish?",opts:["Harira","Tagine","Bastilla","Zaalouk"],a:1},
    {q:"Traditional marketplace?",opts:["Souk","Bazaar","Market","Grand Place"],a:0},
    {q:"Mountain range in Morocco?",opts:["Andes","Atlas","Alps","Himalaya"],a:1},
    {q:"Traditional red felt hat?",opts:["Fez","Turban","Keffiyeh","Beret"],a:0},
    {q:"The Blue City?",opts:["Marrakech","Fes","Casablanca","Chefchaouen"],a:3},
    {q:"Ancient leather tannery city?",opts:["Rabat","Fes","Tangier","Agadir"],a:1},
    {q:"Setting for classic film 'Casablanca'?",opts:["Tangier","Rabat","Casablanca","Marrakech"],a:2},
    {q:"Round flatbread baked in communal ovens?",opts:["Pita","Khobz","Naan","Baguette"],a:1},
    {q:"Ruling dynasty since 1666?",opts:["Alaouite","Sassanid","Ottoman","Pahlavi"],a:0}
  ],
  mexican:[
    {q:"Altar for the dead?",opts:["Ofrenda","Taco","Mole","Fiesta"],a:0},
    {q:"Corn lime treatment process?",opts:["Milling","Nixtamalization","Roasting","Drying"],a:1},
    {q:"Civilization that built Chichen Itza?",opts:["Aztec","Maya","Olmec","Zapotec"],a:1},
    {q:"Spirit made from agave?",opts:["Rum","Vodka","Tequila","Whiskey"],a:2},
    {q:"Famous muralist at National Palace?",opts:["Frida Kahlo","Diego Rivera","Orozco","Siqueiros"],a:1},
    {q:"Mexican currency?",opts:["Peso","Dollar","Real","Quetzal"],a:0},
    {q:"September independence festival?",opts:["Cinco de Mayo","Grito de Dolores","Day of Dead","Carnival"],a:1},
    {q:"Traditional embroidered blouse?",opts:["Huipil","Kimono","Sari","Cheongsam"],a:0},
    {q:"Ancient city built on lake?",opts:["Tenochtitlan","Teotihuacan","Cholula","Tikal"],a:0},
    {q:"Painted skeleton folk art figure?",opts:["Luchador","Catrina","Diabla","Calaca"],a:1}
  ],
  american:[
    {q:"Art Deco NYC icon?",opts:["White House","Empire State","Fallingwater","Arch"],a:1},
    {q:"Slow BBQ smoking technique?",opts:["Frying","Baking","BBQ Smoking","Poaching"],a:2},
    {q:"Document opening with 'We the People'?",opts:["Declaration","Constitution","Bill of Rights","Emancipation"],a:1},
    {q:"National bird?",opts:["Hawk","Eagle","Falcon","Condor"],a:1},
    {q:"River forming Grand Canyon?",opts:["Mississippi","Colorado","Rio Grande","Ohio"],a:1},
    {q:"Traditional Thanksgiving dessert?",opts:["Apple","Pumpkin","Cherry","Pecan"],a:1},
    {q:"Amendment that abolished slavery?",opts:["13th","14th","15th","19th"],a:0},
    {q:"National anthem name?",opts:["America","Star-Spangled","Columbia","Yankee"],a:1},
    {q:"Nickname for New York City?",opts:["Windy City","Big Apple","Sin City","Motor City"],a:1},
    {q:"Wrote Declaration of Independence?",opts:["Washington","Jefferson","Adams","Franklin"],a:1}
  ],
  russian:[
    {q:"Witch who lives in a hut on chicken legs?",opts:["Baba Yaga","Vasilisa","Koschei","Rusalka"],a:0},
    {q:"Colorful onion-shaped church domes?",opts:["Cupolas","Minarets","Spires","Vaults"],a:0},
    {q:"Traditional beet soup?",opts:["Borscht","Shchi","Solyanka","Okroshka"],a:0},
    {q:"Deathless sorcerer in folklore?",opts:["Koschei","Chernobog","Volkh","Boyan"],a:0},
    {q:"Household guardian spirit?",opts:["Domovoi","Leshy","Bannik","Ovinnik"],a:0},
    {q:"City founded by Peter the Great?",opts:["St. Petersburg","Moscow","Novgorod","Kazan"],a:0},
    {q:"Golden feathired mythical bird?",opts:["Firebird","Phoenix","Simurgh","Thunderbird"],a:0},
    {q:"Mountain range dividing Europe/Asia?",opts:["Urals","Caucasus","Carpathians","Altai"],a:0},
    {q:"Tsar who freed the serfs in 1861?",opts:["Alexander II","Peter I","Ivan IV","Nicholas II"],a:0},
    {q:"Traditional fermented rye drink?",opts:["Kvass","Vodka","Mead","Kompot"],a:0}
  ],
  egyptian:[
    {q:"God of the afterlife with jackal head?",opts:["Ra","Anubis","Osiris","Horus"],a:1},
    {q:"River essential to ancient Egypt?",opts:["Tigris","Nile","Euphrates","Amazon"],a:1},
    {q:"Writing system using pictures?",opts:["Cuneiform","Hieroglyphics","Sanskrit","Runes"],a:1},
    {q:"Process of preserving bodies?",opts:["Cremation","Mummification","Embalming","Taxidermy"],a:1},
    {q:"Female pharaoh who wore false beard?",opts:["Nefertiti","Cleopatra","Hatshepsut","Nefertari"],a:2},
    {q:"Stone that decoded hieroglyphics?",opts:["Rosetta","Roswell","Sphinx","Memphis"],a:0},
    {q:"Concept of cosmic truth/order?",opts:["Ka","Ba","Ma'at","Duat"],a:2},
    {q:"Great Pyramid built for?",opts:["Tutankhamun","Khufu","Ramesses","Akhenaten"],a:1},
    {q:"Direction Nile flows?",opts:["North to South","South to North","East to West","West to East"],a:1},
    {q:"Organ left in body during mummification?",opts:["Brain","Heart","Liver","Lungs"],a:1}
  ],
  fantasy:[
    {q:"What color are hobbit doors traditionally?",opts:["Blue","Green","Yellow","Brown"],a:1},
    {q:"Who found the One Ring in the Misty Mountains?",opts:["Frodo","Bilbo","Gandalf","Gollum"],a:1},
    {q:"What is the name of the wizard who visits the Shire?",opts:["Saruman","Radagast","Gandalf","Elrond"],a:2},
    {q:"What time is 'elevensies'?",opts:["9am","11am","1pm","3pm"],a:1},
    {q:"What material are hobbit-holes built into?",opts:["Stone","Wood","Hillsides","Trees"],a:2},
    {q:"What is the Shire's most famous export besides food?",opts:["Gems","Pipe-weed","Wool","Ale"],a:1},
    {q:"Who is the gardener that accompanies Frodo?",opts:["Samwise","Meriadoc","Peregrin","Fatty"],a:0},
    {q:"What protects the Shire from outsiders?",opts:["Walls","The Rangers","Magic","Mountains"],a:1},
    {q:"What birthday gift did Bilgo give Frodo?",opts:["The Ring","Bag End","Money","A sword"],a:0},
    {q:"Which family is considered the most adventurous?",opts:["Baggins","Took","Brandybuck","Gamgee"],a:1}
  ],
  vulcan:[
    {q:"Who is the father of Vulcan logic?",opts:["Spock","Surak","Sarek","T'Pol"],a:1},
    {q:"What does IDIC stand for?",opts:["International Data","Infinite Diversity","Internal Logic","Intellectual Discipline"],a:1},
    {q:"What is the Vulcan mating cycle called?",opts:["Pon farr","Kolinahr","Kahs-wan","Fal-tor-pan"],a:0},
    {q:"What is the traditional Vulcan greeting?",opts:["Peace and Long Life","Live Long and Prosper","May Logic Guide You","Namaste"],a:1},
    {q:"What is a katra?",opts:["A weapon","A living spirit","A starship","A meditation"],a:1},
    {q:"What is the Vulcan science academy located in?",opts:["ShiKahr","Vulcan's Forge","T'Paal","Seleya"],a:0},
    {q:"What technique involves mind-to-mind contact?",opts:["Neuropressure","Mind meld","Telepathy","Pon farr"],a:1},
    {q:"What color is Vulcan blood?",opts:["Red","Blue","Green","Gold"],a:2},
    {q:"What is plomeek?",opts:["A weapon","A soup","A ritual","A city"],a:1},
    {q:"What star does Vulcan orbit?",opts:["Alpha Centauri","Sirius","40 Eridani","Tau Ceti"],a:2}
  ],
  candy:[
    {q:"Who rules the Candy Kingdom?",opts:["Ice King","Marceline","Princess Bubblegum","Flame Princess"],a:2},
    {q:"What are the giant guardians made of?",opts:["Ice","Candy","Gumballs","Chocolate"],a:2},
    {q:"What flows through the kingdom streets?",opts:["Water","Lava","Liquid Candy","Juice"],a:2},
    {q:"What is the sacred building material?",opts:["Stone","Gingerbread","Ice","Wood"],a:1},
    {q:"What is the staple crop grown in fields?",opts:["Wheat","Candy Corn","Rice","Potatoes"],a:1},
    {q:"What color is Princess Bubblegum made of?",opts:["Blue","Green","Pink","Yellow"],a:2},
    {q:"What guards the kingdom from threats?",opts:["Knights","Banana Guards","Dragons","Wizards"],a:1},
    {q:"What is the Princess's first name?",opts:["Bonnibel","Beatrice","Barbara","Bianca"],a:0},
    {q:"What type of science does the Princess practice?",opts:["Alchemy","Mad Science","Biochemistry","All of the above"],a:3},
    {q:"What is the Everything Burrito wrapped in?",opts:["A tortilla","A blanket","A taco","Pizza dough"],a:0}
  ]
};

function initQuiz(c){
  QS[c]={idx:0, done:false, score:0, total:QD[c].length};
  renderQuiz(c);
}

function renderQuiz(c){
  var el=document.getElementById(c+'-quiz'); 
  if(!el) return;
  
  if(QS[c].idx >= QS[c].total){
    var percentage = Math.round((QS[c].score / QS[c].total) * 100);
    var message = "";
    if(percentage === 100) message = "Perfect! You're a master!";
    else if(percentage >= 80) message = "Excellent knowledge!";
    else if(percentage >= 60) message = "Good job!";
    else message = "Keep exploring!";
    
    el.innerHTML = `
      <div class="quiz-score">${QS[c].score}/${QS[c].total}</div>
      <div style="text-align:center;font-size:14px;margin-bottom:15px;opacity:0.8">${message}</div>
      <button class="quiz-restart" onclick="restartQuiz('${c}')">Try Again ‚Ü∫</button>
    `;
    return;
  }
  
  var q=QD[c][QS[c].idx];
  var opts=q.opts.map((o,i)=>(`<button class="quiz-opt" onclick="answer('${c}',${i},this)">${o}</button>`)).join('');
  el.innerHTML=`
    <div class="quiz-progress">Question ${QS[c].idx + 1} of ${QS[c].total}</div>
    <div class="quiz-q" style="font-size:16px;margin-bottom:15px;font-style:italic">"${q.q}"</div>
    <div class="quiz-opts">${opts}</div>
    <div class="quiz-fb" id="${c}-fb"></div>
    <button class="quiz-next" id="${c}-nx" onclick="nextQ('${c}')">Next ‚Üí</button>
    <button class="speak-btn" onclick="speak('${q.q.replace(/'/g,"\\'")}')" style="margin-top:10px">üîä Read Question</button>
  `;
}

function answer(c,i,btn){
  if(QS[c].done) return; 
  QS[c].done=true;
  
  var q=QD[c][QS[c].idx]; 
  var opts=btn.closest('.quiz-opts').querySelectorAll('.quiz-opt');
  
  opts.forEach((o,j)=>{
    o.disabled=true; 
    if(j===q.a) o.classList.add('correct'); 
    else if(j===i && j!==q.a) o.classList.add('wrong');
  });
  
  if(i === q.a) {
    QS[c].score++;
  }
  
  var nextBtn = document.getElementById(c+'-nx');
  if(QS[c].idx === QS[c].total - 1) {
    nextBtn.textContent = "See Score ‚Üí";
  }
  nextBtn.style.display='inline-block';
  
  // Speak feedback
  const feedback = i === q.a ? "Correct!" : "Wrong answer";
  speak(feedback);
}

function nextQ(c){
  QS[c].idx++;
  QS[c].done=false; 
  renderQuiz(c);
}

function restartQuiz(c){
  QS[c]={idx:0, done:false, score:0, total:QD[c].length};
  renderQuiz(c);
}

const CData={
  irish:{
    g:'‚òò',t:'Ireland',s:'Emerald island where Celtic mists conceal portals to the Otherworld, and ancient ogham stones whisper of Gaelic kings.',
    pop:'5.1M',f:'1922',
    spirit:'The Stag of Cernunnos', spirit_desc: 'Antlered guardian of liminal spaces who walks between worlds at twilight when the veil grows thin, master of wild places, fertility, and the eternal hunt through misty forests.',
    folklore:'The Tuatha D√© Danann, Ireland\'s divine race, retreated into the s√≠dhe mounds after defeat to become the Aos S√≠, still influencing mortal affairs. The Banshee\'s mournful keening foretells death in families with O or Mac prefixes. The Puca shifts into black horses or rabbits to lead midnight riders on wild journeys. Leprechauns, the solitary cobblers of the fairy world, guard gold where the rainbow ends. C√∫ Chulainn\'s warp-spasm transformed him into an unrecognizable monster in battle, while Fionn mac Cumhail gained wisdom from the Salmon of Knowledge. T√≠r na n√ìg offers eternal youth beyond the western sea.',
    architecture:'Neolithic passage tombs like Newgrange align precisely with winter solstice sunrise, predating Stonehenge. Medieval round towers soared 100 feet as refuges and belfries against Viking raids. Georgian Dublin\'s terraced townhouses feature colorful doors and fanlights from the 18th century Enlightenment. Thatched cottages with whitewashed walls and half-doors retain heat while admitting light. Crannogs, artificial islands in lakes, date to the Bronze Age. Modern interventions by architects like Grafton Architects merge rough local stone with contemporary concrete in structures like the Curragh Racecourse Stand.',
    techniques:'Soda bread relies on buttermilk\'s lactic acid reacting with baking soda for chemical leavening without yeast, creating a dense, tender crumb with a hard crust. Dublin coddle layers pork sausages and bacon with potatoes and onions, slow-simmering in stout for Saturday night suppers. Bog butter, buried in peat for years, develops umami-rich flavors. Potato varieties like Kerr\'s Pink or Rooster determine mash texture‚Äîfloury for absorption, waxy for salad. Dry-curing and brining preserve meats through Atlantic winters.',
    foods:[
      {e:'ü•ò',n:'Irish Stew',h:'<p>Originating in the 1800s among the working classes, Irish Stew began as a humble peasant dish featuring the cheapest ingredients available: mutton (often neck cuts), potatoes, onions, and parsley. Traditionally made with Guinness or stout in some variations, it was cooked in a heavy iron pot over open hearths. The dish reflects Ireland\'s pastoral heritage and the importance of sheep farming in counties like Wicklow and Kerry.</p><p>The stew thickened naturally through the starch released from the potatoes, requiring no flour-based roux. Each family developed secret variations, with some adding barley, turnips, or carrots. During the Great Famine, this hearty meal sustained thousands of tenant farmers who had little else to eat.</p>'},
      {e:'ü•î',n:'Colcannon',h:'<p>This creamy mash of potatoes and kale (or cabbage) traces back to the 18th century, though some food historians suggest much earlier Celtic origins. The name derives from the Gaelic "c√°l ceannann" meaning white-headed cabbage. Traditionally served at Halloween with charms hidden inside‚Äîcoins for wealth, rings for marriage, thimbles for spinsterhood.</p><p>The dish represents the marriage of Old World cabbage cultivation with the New World potato introduced in the 16th century. In Cork and Kerry, kale is preferred; in other regions, savoy cabbage dominates. The addition of warm milk or cream and scallions creates a "champ" variation, while the inclusion of ham or bacon creates "bubble and squeak" cousins across the Irish Sea.</p>'},
      {e:'üçû',n:'Soda Bread',h:'<p>Developed in the 1840s when bicarbonate of soda became commercially available, Irish Soda Bread emerged from necessity‚Äîyeast was expensive and unreliable in rural kitchens. The chemical reaction between acidic buttermilk and alkaline baking soda creates rapid rising without fermentation. Cross-cuts on top supposedly let fairies escape while baking.</p><p>The "farl" style of Northern Ireland divides the round loaf into four triangular quadrants, while Southern loaves remain whole. Brown soda bread incorporates whole wheat flour (wheatmeal) and molasses or treacle. During the Famine years, this bread sustained families who lacked access to yeast or consistent ovens, baked instead in cast iron pots buried in peat embers.</p>'},
      {e:'ü•û',n:'Boxty',h:'<p>The poor man\'s bread of Ulster and Connacht, Boxty (from the Irish "bacsta√≠") dates to the 18th century when grain shortages forced reliance on potatoes. Made from grated raw potato mixed with mashed potato and flour, it creates a hybrid pancake-bread texture. The rhyme goes: "Boxty on the griddle, boxty on the pan, if you can\'t make boxty, you\'ll never get a man."</p><p>Three distinct varieties exist: boiled dumplings, pan-fried cakes, and loaf bread baked in ovens. The starch from the raw potatoes binds the mixture without eggs. In Leitrim and Cavan, boxty remained a staple through the 1950s, providing carbohydrates for agricultural laborers working peat bogs and potato fields.</p>'},
      {e:'üçñ',n:'Coddle',h:'<p>A Dublin specialty since the 1770s, Coddle (from "caudle," meaning to boil gently) represents urban working-class ingenuity. Leftover sausages and bacon ends were slow-cooked with potatoes and onions in a closed pot, creating a steamy, one-pot Saturday night supper before Sunday abstinence from meat. Jonathan Swift and James Joyce both referenced this "Dublin coddle."</p><p>The dish varies by neighborhood‚Äîsome add barley or carrots, others insist on pure pork and potatoes. The layering technique places meat at the bottom, potatoes on top, creating a self-basting system as fats render upward. It remains a comfort food in Dublin pubs, traditionally served with thick slices of batch loaf and butter.</p>'},
      {e:'ü©∏',n:'Black Pudding',h:'<p>Brought to Ireland by Norman settlers in the 12th century, Black Pudding (put√≥g dhubh) transforms pig\'s blood into a delicacy through the addition of oatmeal, barley, suet, and pennyroyal or mint. Each county claims superiority: Cork\'s version includes heavy cream, while Kerry adds more grain. Drisheen, a Cork variant using sheep\'s blood, appears in tripe and drisheen shops.</p><p>The pudding represents the traditional Irish ethos of "using every part of the pig except the squeal." Blood was collected during autumn pig slaughters and mixed with cereal extenders to create protein-rich puddings that could be sliced and fried for breakfast. Modern artisan producers in Clonakilty and Kanturk have achieved Protected Geographical Indication status for their recipes.</p>'}
    ],
    timeline:[['1541','Henry VIII declared King of Ireland, establishing English Crown sovereignty over the island'],['1607','Flight of the Earls ends ancient Gaelic aristocracy'],['1798','United Irishmen Rebellion for independence, crushed with French aid'],['1845','Great Hunger begins as potato blight causes mass starvation and emigration'],['1916','Easter Rising against British rule, leaders executed but martyrdom galvanizes independence movement'],['1922','Anglo-Irish Treaty establishes Irish Free State as dominion'],['1998','Good Friday Agreement brings peace to Northern Ireland after decades of conflict']]
  },
  portuguese:{
    g:'‚öì',t:'Portugal',s:'Nation of explorers and fado, where Manueline stone meets Atlantic salt and saudade permeates the coastal winds.',
    pop:'10.3M',f:'1139',
    spirit:'The Navigator\'s Ghost', spirit_desc: 'Vasco da Gama\'s eternal specter whispers Saudade to the Atlantic winds, forever seeking the horizon beyond the known world while guarding maritime mysteries.',
    folklore:'The Moura Encantada guards treasures in dolmens and fountains, combing golden hair with ivory combs. Adamastor, the storm-giant of the Cape of Good Hope, represents the ocean\'s wrath against Portuguese expansion. Sebastianism holds that King Sebastian will return in Portugal\'s darkest hour. The Barcelos Rooster legend connects a miracle to the national symbol. Fado music channels the unique Portuguese longing for lost sailors and impossible love, recognized by UNESCO as intangible heritage.',
    architecture:'Manueline style synthesizes Late Gothic with maritime motifs‚Äîropes, coral, and exotic flora carved in limestone at Bel√©m Tower and Jer√≥nimos Monastery. Pombaline architecture introduced the world\'s first earthquake-resistant building system after the 1755 Lisbon disaster, using wooden cage structures within stone facades. Azulejos, blue tin-glazed ceramic tiles, narrate religious and historical scenes on building exteriors. The Alentejo features whitewashed medieval villages with castellated walls, while Porto displays Victorian iron and glasswork in its market halls.',
    techniques:'Grelhado utilizes charcoal grilling over piri-piri or bay leaf branches for aromatic smoke. Refogado forms the base of most dishes‚Äîslowly saut√©ing onions, garlic, and olive oil until sweet and translucent. Bacalhau preparation involves drying and salting cod, then rehydrating through multiple water changes over 24-48 hours. Port wine production requires fortifying grape must with brandy during fermentation to preserve sweetness. Cataplana cooking uses sealed copper vessels to steam shellfish in their own juices with herbs.',
    foods:[
      {e:'üêü',n:'Bacalhau',h:'<p>Portugal\'s "fiel amigo" (faithful friend), salt cod entered the national diet in the 15th century when Portuguese explorers discovered abundant cod stocks off Newfoundland. The salting process allowed preservation for transoceanic voyages, creating 365+ recipes‚Äîone for each day of the year. "Bacalhau √† Br√°s" (shredded with potatoes and eggs) and "Bacalhau com Natas" (with cream) are Lisbon favorites.</p><p>The fish requires desalination through multiple water changes over 24-48 hours before cooking. Traditional "klippfisk" from Norway remains preferred over Canadian cod for texture. The massive "Festas dos Santos Populares" in June feature grilled bacalhau served with roasted peppers and potatoes, representing both Catholic fasting traditions and maritime heritage.</p>'},
      {e:'ü•ß',n:'Pastel Nata',h:'<p>Created by monks at Bel√©m\'s Jer√≥nimos Monastery in the 18th century, these custard tarts (past√©is de nata) used leftover egg yolks from starching religious habits with egg whites. After the Liberal Revolution of 1820 closed monasteries, the recipe was sold to a sugar refinery, eventually opening the famous "Antiga Confeitaria de Bel√©m" in 1837.</p><p>The secret lies in the lamination‚Äîfolding butter into dough 3-4 times to create 128+ layers‚Äîand caramelizing the custard surface at 400¬∞F. The contrast between flaky pastry and creamy egg custard, dusted with cinnamon and powdered sugar, has made this Lisbon\'s greatest culinary export. Over 20,000 are sold daily at the original bakery.</p>'},
      {e:'üç∑',n:'Port Wine',h:'<p>Born from 17th-century trade wars with France, Port wine emerged when British merchants added brandy to Portuguese wine to prevent spoilage during sea voyages. The Douro Valley\'s schist soils and steep terraces create unique conditions for Touriga Nacional grapes. The wine is fortified during fermentation, preserving natural sugars while raising alcohol to 20%.</p><p>Vintages are declared only in exceptional years, while Tawny ports age in wooden casks oxidizing to amber hues. The wine lodges of Vila Nova de Gaia across from Porto store millions of liters in barrels. British families like Symington and Croft controlled the trade for centuries, establishing the distinct categories: Ruby, Tawny, White, and Colheita.</p>'},
      {e:'ü•¨',n:'Caldo Verde',h:'<p>Originating in the Minho province, this "green broth" sustained farmers working the terraced fields of northern Portugal. Collard greens (couve galega) are sliced into thin ribbons (cortadas em juliana) and simmered with potatoes, onions, and garlic, finished with chouri√ßo sausage. The soup represents the Minho\'s Celtic agricultural traditions.</p><p>The key technique is "refogado"‚Äîslowly saut√©ing aromatics in olive oil before adding liquid. Traditionally served from "tigelas" (clay bowls) during the Feast of St. John in Porto, where it accompanies grilled sardines. The dish exemplifies "cozinha pobre" (peasant cooking), transforming humble ingredients into sustaining comfort through technique rather than expensive components.</p>'},
      {e:'ü•™',n:'Francesinha',h:'<p>Invented in 1953 by Daniel da Silva, a Portuguese immigrant returning from France, this "little French girl" is Porto\'s decadent answer to the croque-monsieur. Layers of steak, ham, lingui√ßa, and mortadella between thick bread, covered in melted cheese and a secret beer-tomato sauce, served with french fries.</p><p>Each restaurant guards its sauce recipe‚Äîsome use Port wine, others beer or brandy. The Caf√© Santiago in Porto serves the canonical version, though over 200 establishments claim superiority. This represents Portugal\'s mid-century fascination with French cuisine filtered through local ingredients and excess, creating a hangover cure beloved by university students and workers alike.</p>'},
      {e:'üêô',n:'Polvo',h:'<p>Octopus (polvo) defines coastal Portuguese cuisine, particularly in the Algarve and Azores where the mollusk is abundant. "Polvo √† Lagareiro"‚Äîboiled then roasted with garlic, coriander, and olive oil‚Äîshowcases the Portuguese mastery of seafood. The tradition of beating octopus against rocks to tenderize it dates to Phoenician times.</p><p>The fishing method using clay pots ("alcatruzes") exploits octopus\'s habit of seeking dark shelters. In Santa Luzia near Tavira, octopus is the economic backbone, dried and salted for winter or served fresh in rice dishes. The Santa Luzia festival in August celebrates the creature that sustained fishermen during long Atlantic voyages, representing the deep connection between Portuguese identity and the sea.</p>'}
    ],
    timeline:[['1415','Ceuta captured, beginning the Age of Discovery'],['1494','Treaty of Tordesillas divides the world between Portugal and Spain'],['1500','Pedro √Ålvares Cabral claims Brazil for Portugal'],['1580','Iberian Union under Spanish Habsburg rule begins 60-year period'],['1640','Restoration of Independence from Spain under Duke of Braganza'],['1755','Great Lisbon Earthquake destroys capital, prompting Enlightenment urban planning'],['1974','Carnation Revolution ends Estado Novo dictatorship through nearly bloodless military coup']]
  },
  japanese:{
    g:'‚õ©',t:'Japan',s:'Where Zen Buddhism meets high-tech futurism, Shinto kami inhabit waterfalls, and the seasons dictate aesthetic consciousness.',
    pop:'125.7M',f:'660 BC',
    spirit:'The Nine-Tailed Kitsune', spirit_desc: 'Master of illusion shifting between neon-lit Tokyo alleys and ancient Inari shrines, possessing wisdom accumulated over centuries and the power to transmute into human form.',
    folklore:'Y≈çkai spirits number eight million, from the water-loving Kappa with their head-bowl weakness to the mountain Tengu with long noses teaching martial arts. Shinto Kami reside in waterfalls, rocks, and ancient trees, requiring purification rituals. The Tanuki shape-shifts to trick merchants, while the Kitsune serves Inari as messenger. Heroes like Momotaro emerge from peach stones to conquer Oni demons. Setsubun rituals drive out ogres before spring. The concept of Ma‚Äînegative space‚Äîdefines both art and social interaction.',
    architecture:'Wooden joinery eliminates nails through complex interlocking joints that flex during earthquakes. Pagodas feature internal shinbashira pillars that counteract seismic waves through pendulum motion. Machiya townhouses in Kyoto use narrow facades and deep gardens for climate control. Engawa verandas blur interior-exterior boundaries. The Metabolism movement of the 1960s created plug-in capsule towers like Nakagin. Contemporary architects like Tadao Ando employ smooth concrete and natural light to create spiritual voids in buildings like the Church of the Light.',
    techniques:'Fermentation produces miso, shoyu, and natto through Koji mold enzymes breaking down proteins. Dashi extraction utilizes kombu glutamates and bonito flakes to create the umami fifth taste identified by Ikeda in 1908. Binchotan charcoal grilling provides infrared heat without flame. Katsuramuki technique rotates daikon in one continuous sheet. Sushi rice requires specific Japonica short-grain varieties seasoned with rice vinegar, sugar, and salt while fan-cooled. Kaiseki cuisine arranges dishes to reflect the passing seasons through ceramics and garnishes.',
    foods:[
      {e:'üç£',n:'Sushi',h:'<p>Originally developed in Southeast Asia as "narezushi"‚Äîfermented fish preserved in rice‚Äîsushi evolved in Edo-period Tokyo (1603-1868) into the vinegared rice form we recognize. Hanaya Yohei (1799-1858) created "nigiri" sushi as fast food for busy merchants, topping hand-pressed rice with fresh fish from Tokyo Bay.</p><p>The rice seasoning (sushi-zu) balances rice vinegar, sugar, and salt, cooled by hand-fanning while mixing. Regional styles vary: Osaka\'s "oshizushi" is pressed in wooden molds, while Kyushu features "sasazushi" wrapped in bamboo leaves. The Itamae (chef) undergoes years of apprenticeship, learning to age tuna for optimal texture and calculate rice acidity for preservation.</p>'},
      {e:'üçú',n:'Ramen',h:'<p>Though Chinese wheat noodles arrived in Japan in the 19th century, ramen crystallized as a distinct cuisine in 1910 Yokohama\'s Chinatown. Post-WWII, black market stalls near train stations sold affordable "shina soba" to workers. The four foundational broths emerged: Tonkotsu (pork bone) from Kyushu, Miso from Hokkaido, Shoyu from Tokyo, and Shio (salt) from Hakodate.</p><p>Instant ramen was invented by Momofuku Ando in 1958, creating a global phenomenon. Regional variations number in the hundreds: Kitakata ramen features flat curly noodles in soy broth; Tsukemen offers dipping noodles separate from concentrated broth. The "ie-kei" style of Yokohama adds spinach, nori, and char siu to thick pork broth, representing the continual evolution of this working-class staple.</p>'},
      {e:'üçµ',n:'Matcha',h:'<p>Introduced by Zen monk Eisai in 1191 upon returning from Song Dynasty China, powdered green tea became the spiritual foundation of Japanese aesthetics. The "chanoyu" (tea ceremony) codified by Sen no Riky≈´ in the 16th century transformed tea preparation into a philosophical practice emphasizing "wabi-sabi"‚Äîbeauty in imperfection and impermanence.</p><p>Matcha production requires shading tea plants for 20 days before harvest, increasing chlorophyll and amino acids. The leaves are steamed, dried, and stone-ground into micro-powder. Uji, Kyoto Prefecture, produces the highest grade used in formal ceremonies. The utensils (chawan, chasen, natsume) are themselves art objects, with Raku ware tea bowls prized for their deliberate irregularity.</p>'},
      {e:'üç§',n:'Tempura',h:'<p>Introduced by Portuguese missionaries in the 16th century (likely derived from the Portuguese "tempero" or Ember fast days), tempura was adapted by Tokyo Bay fishermen who fried seafood in sesame oil. The Edo period (1603-1868) saw tempura evolve from street food to high cuisine, with specialized restaurants ("tempura-ya") opening near the Sumida River.</p><p>The batter technique keeps ingredients ice-cold while oil reaches 340-360¬∞F, creating the characteristic "saku-saku" (crispy) texture. "Tentsuyu" dipping sauce combines dashi, mirin, and soy sauce, often with grated daikon. Kakiage mixes vegetable strips into fritters. Unlike Western frying, tempura aims for a gossamer-light coating that shatters delicately, revealing the pristine flavor of the ingredient within.</p>'},
      {e:'üç•',n:'Udon',h:'<p>These thick wheat noodles likely arrived from China during the Nara period (710-794), though some theories suggest ancient Japanese origins. Kagawa Prefecture on Shikoku island, known as "Udon Prefecture," produces "Sanuki udon" with distinctive square edges and firm bite achieved through foot-kneading dough in straw sacks.</p><p>The noodles are served hot in "kakejiru" (dashi-soy broth) or cold with dipping sauce ("zaru udon"). "Kitsune udon" adds sweet fried tofu (aburaage) named after fox spirits\' supposed love of fried foods. "Chikara udon" includes mochi rice cakes for strength. The industrial city of Nagoya serves "miso nikomi udon" baked in clay pots with red miso, representing regional pride in hatch≈ç miso production.</p>'},
      {e:'üç±',n:'Kaiseki',h:'<p>The pinnacle of Japanese cuisine, kaiseki originated as vegetarian temple food (sh≈çjin ry≈çri) served before tea ceremonies in Kyoto. Over centuries, it incorporated seasonal fish and vegetables into a multi-course artistic presentation emphasizing "shun" (peak seasonal ingredients). The meal progresses from sakizuke (appetizer) to mizumono (dessert), each dish reflecting the current moon phase or blooming flowers.</p><p>Ceramic plates are chosen to complement specific dishes‚Äîautumn maple leaves on red raku ware, spring cherry blossoms on white porcelain. The "hassun" course sets the seasonal theme with mountain and sea ingredients arranged on a square platter. This cuisine influenced global fine dining through its emphasis on terroir, minimal manipulation of ingredients, and the philosophy that the eyes should feast before the mouth.</p>'}
    ],
    timeline:[['538','Buddhism introduced from Korea, syncretizing with Shinto beliefs'],['794','Heian Period begins with capital move to Kyoto, birth of classical culture'],['1185','Kamakura Shogunate establishes military government rule'],['1543','Portuguese introduce firearms and Christianity to Tanegashima'],['1603','Tokugawa Shogunate begins Edo Period and 250 years of isolation'],['1868','Meiji Restoration ends feudalism and rapid Westernization begins'],['1945','Phoenix reconstruction after atomic bombings leads to economic miracle'],['2011','T≈çhoku earthquake and tsunami triggers Fukushima nuclear disaster']]
  },
  moroccan:{
    g:'‚ú¶',t:'Morocco',s:'Kingdom of spices and hospitality, where Atlas Mountains meet Sahara dunes and the call to prayer echoes across ancient medinas.',
    pop:'37.3M',f:'788 AD',
    spirit:'The Desert Djinn', spirit_desc: 'Smokeless fire being protecting Kasbah gates and Saharan secrets, dwelling in the threshold spaces between light and shadow, capable of granting wishes or leading travelers astray.',
    folklore:'Jinn inhabit unclean places, corners, and ruins, requiring salt lines or iron for protection. Aisha Qandisha appears as a beautiful woman with goat legs near water sources. Gnawa musicians use the guembri to heal spirit possession through all-night derdeba ceremonies. The tradition of Hikayat oral storytelling in Jemaa el-Fnaa square preserves epics like the Tale of El-Muddene. Blue doors in Chefchaouen ward off evil spirits. Amazigh (Berber) traditions involve silver jewelry as protective amulets against the evil eye.',
    architecture:'Riads center on courtyard gardens with citrus trees and fountains, providing privacy and evaporative cooling. Mashrabiya latticework screens allow women to observe streets while remaining concealed. Earthen Kasbahs in the south use pis√© de terre‚Äîrammed earth‚Äîfor thermal mass. Zellige tilework employs hand-cut geometric ceramic pieces set in plaster with star patterns symbolizing infinity. The Koutoubia Mosque and Hassan II Mosque showcase Almohad and contemporary Islamic architecture. Berber tents use woven goat hair that expands when wet to seal against rain.',
    techniques:'Tagine slow-braising utilizes the conical lid to recirculate steam back into the dish, requiring minimal water in arid climates. Hand-rolling semolina for couscous involves multiple steamings in a couscoussier. Preserved lemons ferment in salt for weeks to develop piquant depth. Argan oil extraction requires cracking nuts between stones and cold-pressing. Mechoui involves roasting whole lamb in pit ovens. Mint tea pouring from height aerates and cools the brew while creating signature foam.',
    foods:[
      {e:'ü´ï',n:'Tagine',h:'<p>Named after the conical earthenware pot invented by the Berbers centuries ago, the tagine represents Saharan survival cooking. The distinctive lid condenses steam and returns moisture to the stew, allowing tough cuts of meat to tenderize with minimal water in arid environments. The city of Safi is renowned for its blue-glazed tagine pottery.</p><p>Classic combinations include "mrouzia" (lamb with raisins, honey, and Ras el hanout spice blend), "chicken with preserved lemons and olives," and "kefta mkaouara" (meatballs in tomato sauce with eggs). The spice blend Ras el hanout ("top of the shop") may contain 20-30 ingredients including rose petals, grains of paradise, and Spanish fly (lytta vesicatoria). Each family guards its unique blend.</p>'},
      {e:'üç≤',n:'Harira',h:'<p>This hearty tomato-based soup breaks the Ramadan fast in Moroccan homes, dating to the Almohad dynasty (12th-13th centuries). The name derives from the Arabic word for silk, describing the smooth texture achieved by pureeing tomatoes, lentils, chickpeas, and celery with herbs like cilantro and parsley. "Chebakia" (honey-soaked sesame cookies) traditionally accompany the soup.</p><p>Fes is renowned for the most refined Harira, while Casablanca adds more spice. The soup contains "tedouira"‚Äîa mixture of flour and water added at the end to thicken. During Ramadan, communal kitchens prepare huge quantities for the poor, reflecting the Islamic pillar of charity. The combination of protein, complex carbohydrates, and hydration restores energy after daylight fasting.</p>'},
      {e:'üçµ',n:'Mint Tea',h:'<p>Introduced in the 18th century through British trade with the port of Tangier, green tea (specifically Chinese gunpowder tea) became the foundation of Moroccan hospitality. The addition of fresh mint (naanaa) and sugar created "Moroccan whiskey," the national beverage served throughout the day. The ritual of preparation‚Äîrinsing leaves, boiling water, and pouring from height‚Äîsignifies respect for guests.</p><p>The pouring technique creates a frothy "turban" on top; higher pouring indicates greater honor. Tuareg and Saharan tribes add generous sugar, while northern regions prefer less sweetness. The tea ceremony follows strict rules: the host tastes first to ensure quality, then serves guests three rounds‚Äî"gentle as life," "strong as love," and "bitter as death." Refusing tea constitutes a serious insult.</p>'},
      {e:'ü•ò',n:'Couscous',h:'<p>The staple of Maghrebi cuisine predates Arab arrival, with evidence of couscous consumption among Berbers in the 11th century. The process involves rolling moistened semolina wheat by hand to create tiny pellets, then steaming multiple times in a "couscoussier" (double-chambered pot) over stewing meat. Friday couscous after mosque prayers remains a sacred tradition.</p><p>The "seffa" preparation sweetens couscous with cinnamon, sugar, and raisins. "Couscous royale" combines lamb, chicken, and merguez sausage with seven vegetables representing good luck. Fez is famous for "Couscous Tfaya" with caramelized onions and raisins. UNESCO recognized the knowledge and know-how of couscous production as Intangible Cultural Heritage in 2020, acknowledging Morocco, Algeria, Tunisia, and Mauritania.</p>'},
      {e:'ü•ß',n:'Pastilla',h:'<p>A masterpiece of Andalusian cuisine preserved in Fes, this sweet-savory pigeon (or chicken) pie encased in warqa dough (similar to phyllo) represents the height of Moorish culinary artistry. The filling combines slow-braised poultry with spiced eggs, fried almonds, and cinnamon, dusted with powdered sugar and cinnamon on top.</p><p>The contrast of savory meat, aromatic spices (ras el hanout, saffron), scrambled eggs, and crispy pastry creates a unique flavor profile found nowhere else. Originally served at weddings and celebrations, it demonstrates the Arab preference for combining meat with dried fruits and nuts. The warqa paper is traditionally made by dabbing dough on a heated inverted copper dome, a technique requiring years to master.</p>'},
      {e:'ü•û',n:'Msemen',h:'<p>These flaky, layered pancakes (also called Rghaif) originated in the Maghreb among Berber populations, serving as versatile bread for breakfast or accompaniment to tagines. The dough is kneaded, flattened, folded into squares with oil and semolina between layers, then griddled until golden and crispy outside, tender inside.</p><p>Msemen requires significant skill to achieve the proper lamination without tearing the delicate dough. Street vendors in Marrakech and Fes sell them hot with honey and butter ("msemen maaassal") or stuffed with "kefta" (spiced ground meat). During Eid celebrations, families prepare massive quantities to serve guests with mint tea, representing the sharing of abundance central to Moroccan hospitality culture.</p>'}
    ],
    timeline:[['1578','Battle of the Three Kings ends Portuguese invasions with royal deaths'],['1666','Alaouite Dynasty ascends, still ruling today under King Mohammed VI'],['1777','Morocco becomes first nation to recognize American independence from Britain'],['1912','Treaty of Fez establishes French and Spanish protectorates'],['1956','Independence regained from France under Mohammed V'],['1999','Mohammed VI ascends throne, initiating gradual modernization and women\'s rights reforms'],['2011','Constitutional reforms and first free elections following Arab Spring protests']]
  },
  mexican:{
    g:'ü¶Ö',t:'M√©xico',s:'Pyramids and cosmic colors, where indigenous wisdom syncretizes with colonial baroque, and death is celebrated as a continuation of life.',
    pop:'128.9M',f:'1810',
    spirit:'The Feathered Serpent', spirit_desc: 'Quetzalcoatl, bringer of maize and knowledge, soaring above obsidian mirrors with jade wind jewels, representing the boundary between earth and sky.',
    folklore:'Nagual shapeshifters transform into animals like jaguars or coyotes through tonal connections. La Llorona wanders waterways mourning her drowned children. Alebrijes, fantastical spirit creatures carved from copal wood, guide souls in the afterlife according to Oaxacan traditions. The Day of the Dead syncretizes Aztec Mictecacihuatl worship with Catholic All Souls Day, constructing ofrendas with marigold pathways and pan de muerto. Cempas√∫chil flowers guide spirits home with scent and color. Tonal√° pottery tradition involves burnished clay techniques from pre-Columbian times.',
    architecture:'Teotihuacan and Chichen Itza align pyramids with celestial events like equinoxes. Churrigueresque Baroque facades feature stucco estipite columns and gold leaf in churches like Santa Prisca. Luis Barrag√°n\'s modernism employs vibrant pink walls and geometric water features for spiritual contemplation. Haciendas feature arched colonnades and central patios for ventilation. Adobe construction uses mud brick with high thermal mass for desert climates. Diego Rivera murals in public buildings narrate indigenous history and socialist ideals through fresco technique on wet lime plaster.',
    techniques:'Nixtamalization treats corn with calcium hydroxide (lime) to release niacin and improve protein quality, preventing pellagra and creating masa for tortillas. Mole poblano requires thirty-plus ingredients including multiple chiles, chocolate, and spices, ground on metate stones. Tatemado charring blackens chiles and tomatoes on comal griddles for salsa depth. Barbacoa involves slow-cooking meat in maguey-lined underground pits. Conching chocolate for 72 hours creates smooth mouthfeel. Al pastor adapts Lebanese shawarma technique to pork with pineapple and guajillo chiles.',
    foods:[
      {e:'üåÆ',n:'Tacos',h:'<p>The word derives from Nahuatl "tlahco" (half or in the middle), describing the way filling is placed in the tortilla. While indigenous peoples wrapped food in tortillas for millennia, the modern taco emerged in 18th-century silver mining districts of Mexico, where miners used "plugs" of paper wrapped around gunpowder‚Äîcalled tacos‚Äîto excavate ore. The food version provided portable sustenance.</p><p>Tacos al pastor evolved from Lebanese immigrants\' shawarma in the 1960s Puebla, using pork marinated in guajillo and achiote on a vertical trompo (spinning top). Tacos de canasta (basket tacos) are steamed in cloth inside wicker baskets sold by bicycle vendors. The distinction between soft corn tortillas and crispy American-style tacos (actually "tacos dorados") reflects the border\'s culinary evolution.</p>'},
      {e:'ü´î',n:'Tamales',h:'<p>Pre-dating Aztec civilization, tamales appear in Maya and Aztec banquets depicted in codices and described by Bernal D√≠az del Castillo during Cort√©s\'s feast with Moctezuma. The tamal (from Nahuatl "tamalli") utilized nixtamalized corn masa wrapped in corn husks or banana leaves, steamed in underground pits or above-ground pots.</p><p>Regional variations number in the hundreds: Oaxaca wraps mole negro in banana leaves; Yucat√°n produces "colados" with strained masa; Michoac√°n makes "corundas" triangular like boats. "Tamales oaxaque√±os" represent the most complex, with mole amarillo or coloradito. Christmas Eve (Nochebuena) requires "tamaladas" where families gather to assemble hundreds of tamales, maintaining communal bonds through masa preparation.</p>'},
      {e:'ü•ë',n:'Guacamole',h:'<p>The Aztecs created "ahuacamolli" (avocado sauce) by mashing avocados with mortar and pestle in the 14th century, documented by Fray Bernardino de Sahag√∫n. The avocado (Persea americana) originated in the Tehuac√°n Valley of Puebla state, cultivated since 5000 BCE. The fruit was considered so sensual that Aztec virgins were kept indoors during harvest season.</p><p>Traditional preparation uses a molcajete (lava stone mortar) to grind jalape√±os, cilantro, onion, and tomato with the avocados, maintaining chunky texture rather than pureeing. Guacamole represents the "salsa" category in Mexican cuisine‚Äîuncooked accompaniments that contrast with cooked main dishes. Modern variations add pomegranate seeds for crunch or toasted pepitas, though purists insist on only five ingredients.</p>'},
      {e:'üç≤',n:'Pozole',h:'<p>This ritual stew of hominy (nixtamalized corn kernels) and meat originated in pre-Columbian Mexico, where it was served at religious ceremonies‚Äîpossibly including human sacrifice, with Spanish chroniclers noting Aztec priests consuming stew containing prisoner flesh. Post-Conquest, pork replaced human meat, creating the modern "pozole blanco," "rojo" (red with chile guajillo), or "verde" (with tomatillos).</p><p>Guerrero, Jalisco, and Sinaloa each claim the definitive version. Jalisco uses pork head and trotters for collagen richness, while Guerrero adds radishes, avocado, and chicharr√≥n toppings. Independence Day (September 16) celebrations traditionally feature pozole, connecting modern Mexicans to ancestral festivities.</p>'},
      {e:'üå∂Ô∏è',n:'Mole',h:'<p>The legend of mole poblano\'s invention in the 1680s at Santa Rosa Convent in Puebla involves panicked nuns improvising a sauce for the archbishop from available chiles, chocolate, nuts, and spices. In reality, the dish evolved from pre-Hispanic "chilmole" (chile sauce) combined with Spanish sweet spices. Preparing true mole requires 30+ ingredients and three days of toasting, soaking, frying, and grinding on metate stones.</p><p>Oaxaca is the "land of seven moles" including negro (black with chocolate), coloradito (little red), and verde. Each mole represents a specific celebration‚Äîmole negro for weddings, chichilo for funerals. The chocolate used is unsweetened and complex, providing depth rather than sweetness. Pipian moles use pumpkin seeds instead of chocolate, reflecting pre-Columbian traditions before cacao became currency.</p>'},
      {e:'ü•©',n:'Barbacoa',h:'<p>The word "barbecue" derives from Caribbean Ta√≠no "barbacoa," adopted by Spanish colonists to describe the indigenous method of slow-cooking meat over indirect heat. In Central Mexico, barbacoa specifically refers to pit-cooked lamb or goat wrapped in maguey leaves and buried over hot coals for 12-18 hours, creating tender, smoky meat consumed Sunday mornings.</p><p>The state of Hidalgo, particularly the town of Texcoco, is the epicenter, where "pancita" (stomach) is stuffed with organs and spices, sewn shut, and cooked alongside the head. The consomm√©‚Äîbroth collected from the cooking process‚Äîis seasoned with garbanzo beans and served as soup. This technique predates European colonization, using the earth itself as an oven, and represents the ultimate expression of Mexican "tiempo lento" (slow time).</p>'}
    ],
    timeline:[['1325','Tenochtitlan founded on lake island that becomes Mexico City'],['1521','Fall of Tenochtitlan to Cort√©s and Tlaxcalan allies ends Aztec Empire'],['1810','Hidalgo issues Grito de Dolores initiating War of Independence from Spain'],['1848','Treaty of Guadalupe Hidalgo cedes half of national territory to USA after war'],['1910','Mexican Revolution begins against Porfirio D√≠az dictatorship, lasting decade'],['1968','Tlatelolco massacre kills hundreds of student protesters before Olympics'],['1994','Zapatista uprising in Chiapas advocates for indigenous rights against NAFTA effects'],['2006','Drug war escalation begins with military deployment against cartels']]
  },
  american:{
    g:'üóΩ',t:'USA',s:'Melting pot of liberty, from indigenous mounds to steel-frame skyscrapers, where regional diversity spans 3.8 million square miles.',
    pop:'333.3M',f:'1776',
    spirit:'The Great Thunderbird', spirit_desc: 'Wings stretching across plains of innovation, controlling weather and representing power among Plains tribes, manifesting today in storm systems and technological lightning.',
    folklore:'Indigenous tricksters include Coyote (Navajo), Raven (Pacific Northwest), and Great Hare (Woodlands). Paul Bunyan and Babe the Blue Ox represent logging camp tall tales. Cryptids like Bigfoot, Mothman, and the Jersey Devil populate regional imagination. Johnny Appleseed spread apple trees and Swedenborgian mysticism. Brer Rabbit stories derive from African Anansi tales. The Headless Horseman of Sleepy Hollow reflects Dutch colonial fears. Regional ghost stories include the Bell Witch of Tennessee and La Llorona variations in the Southwest.',
    architecture:'Sears Roebuck kit homes democratized Craftsman style across the Midwest. Shotgun houses in the South feature linear layouts for cross-ventilation. Adobe Pueblo structures in New Mexico use continuous timber beams (vigas) and mud plaster. Chicago School skyscrapers like the Home Insurance Building pioneered steel-frame construction. Fallingwater integrates cantilevered concrete over waterfalls. Googie architecture in Los Angeles features boomerang shapes and neon for the Space Age. Contemporary firms like SHoP and Diller Scofidio + Renfro employ parametric design and smart materials.',
    techniques:'Low-and-slow BBQ smoking developed from Caribbean barbacoa, utilizing specific regional hardwoods‚Äîhickory in the Carolinas, mesquite in Texas, apple in Virginia. Dry-aging beef in controlled humidity concentrates flavor through enzymatic action. Sous-vide cooking, pioneered in French laboratories, gained American popularity for precision temperature control. Indigenous nixtamalization influenced Southern hominy preparation. Bourbon production requires new charred oak barrels and Kentucky\'s limestone-filtered water. New York bagels are boiled in malted water before baking for chewiness.',
    foods:[
      {e:'üçî',n:'Hamburger',h:'<p>Originating in Hamburg, Germany, as "Hamburg steak," the ground beef patty sandwich became distinctly American at the 1904 St. Louis World\'s Fair. Louis\' Lunch in New Haven, Connecticut, claims invention of the vertical-broiled version in 1900, served on white toast rather than buns. The post-WWII fast food boom standardized the format through chains like McDonald\'s and In-N-Out.</p><p>Regional variations reflect local identity: Juicy Lucy (Minneapolis) seals cheese inside the patty; New Mexico adds green chiles; Oklahoma styles feature fried onion mashed into the beef. The "smash burger" technique, popularized in the Midwest, presses thin patties onto hot griddles for maximum Maillard reaction crust. American beef production and grain feeding create the specific fatty marbling that defines the classic taste.</p>'},
      {e:'ü•ß',n:'Apple Pie',h:'<p>Despite the phrase "as American as apple pie," apples are not native to North America, and the dessert derives from British and Dutch traditions. However, John Chapman (Johnny Appleseed) established orchards across the frontier in the early 1800s, making apples a symbol of westward expansion. The lattice crust and cinnamon-spiced filling became standardized in 20th-century cookbooks.</p><p>Vermont claims apple pie as its state pie, sometimes served with sharp cheddar cheese‚Äîa tradition from English settlers. The phrase "for Mom and apple pie" emerged during WWII as a slogan of American values. Regional variations include sour cream apple pie (Amish), salted caramel versions (West Coast), and mock apple pie made with Ritz crackers during the Great Depression when fruit was scarce.</p>'},
      {e:'üçó',n:'Fried Chicken',h:'<p>The synthesis of West African spice traditions and Scottish deep-frying techniques created Southern fried chicken in the antebellum period. Enslaved cooks perfected the seasoning and batter methods that distinguished plantation cooking. After the Civil War, African American entrepreneurs opened restaurants featuring "gospel bird," establishing the dish as a cornerstone of soul food.</p><p>Nashville Hot Chicken emerged from the spicy preferences of Thornton Prince\'s girlfriend, who sought revenge for his infidelity by dousing his chicken with cayenne. The dish became a city specialty. Kentucky Fried Chicken, founded by Colonel Harland Sanders in 1952, internationalized the dish through pressure-frying techniques and proprietary seasoning blends of 11 herbs and spices.</p>'},
      {e:'ü•û',n:'Pancakes',h:'<p>Flat cakes cooked on hot stones predate colonization, but American "flapjacks" evolved from Dutch settlers\' "pannekoeken" and German "Pfannkuchen." The frontier tradition of stacking high and covering with maple syrup‚Äîtapped from northeastern forests‚Äîcreated the iconic breakfast. Buckwheat versions sustained New Englanders through harsh winters.</p><p>The franchising of the International House of Pancakes (IHOP) in 1958 standardized the buttermilk pancake nationally. Regional variations include silver dollar pancakes (Pennsylvania Dutch), sourdough hotcakes (Alaska and the West), and Dutch babies (German-American puffed oven pancakes). The secret to fluffiness involves not overmixing batter, preserving lumps that create air pockets when hitting the griddle.</p>'},
      {e:'üå≠',n:'Hot Dog',h:'<p>Frankfurter sausages arrived with German immigrants in the 1860s, with Charles Feltman selling them from a Coney Island pie wagon in 1867. The "hot dog" name possibly derives from dachshund sausages sold by college vendors, or a cartoon by T.A. Dorgan depicting the elongated shape. Nathan\'s Famous opened in 1916, establishing the July 4th eating contest tradition.</p><p>Regional styles define the culture: Chicago dogs feature neon-green relish, sport peppers, and celery salt on poppy seed buns; New York uses steamed onions and pale yellow mustard; Detroit serves "Coney dogs" with chili and diced onions; Sonoran dogs from Tucson wrap bacon around the sausage and top with beans and jalape√±os. Street cart "dirty water dogs" sustained New York workers through the 20th century.</p>'},
      {e:'ü¶É',n:'Thanksgiving Dinner',h:'<p>The 1621 harvest feast between Plymouth colonists and Wampanoag lasted three days, featuring wildfowl, deer, and corn, but likely not turkey or pie. Sarah Josepha Hale campaigned for 17 years to make Thanksgiving a national holiday, achieved by Lincoln in 1863 to unify the Civil War-torn nation. The "traditional" menu crystallized in the 20th century through magazine promotions.</p><p>Butterball turkeys, introduced in the 1950s, dominate modern tables alongside canned cranberry sauce (invented by Marcus Urann in 1912) and marshmallow-topped sweet potatoes (a 1917 promotional recipe). Regional variations include oyster stuffing (Southern coastal), wild rice dishes (Minnesota), and chile-spiced turkey (New Mexico). The meal represents the American myth of harmonious indigenous-colonist relations despite historical genocide.</p>'}
    ],
    timeline:[['1776','Declaration of Independence from British rule'],['1861','Civil War begins over slavery and states\' rights'],['1869','Transcontinental Railroad connects coasts, enabling mass migration'],['1920','19th Amendment grants women\'s suffrage'],['1941','Pearl Harbor attack brings USA into WWII'],['1969','Apollo 11 lands first humans on the Moon'],['2001','September 11 attacks reshape foreign policy and domestic security'],['2008','Election of first African American president, Barack Obama']]
  },
  russian:{
    g:'‚ò≠',t:'Russia',s:'Boundless taiga and steppe, where onion domes pierce the sky and the samovar steams with Eurasian endurance.',
    pop:'146M',f:'862 AD',
    spirit:'The Firebird', spirit_desc: 'Glowing plumage illuminating dark forests, representing the impossible quest and resurrection in Slavic legend, her feathers glowing with internal flame that brings both blessing and sorrow.',
    folklore:'Baba Yaga lives in a hut on chicken legs, flying in a mortar and pestle, guarding the fire between benevolence and malevolence. Koschei the Deathless hides his soul in a needle, egg, duck, hare, and stone chest. The Domovoi protects hearth and home, living behind the stove. Rusalki, drowned spirits, lure men to watery graves. The Leshy guards forests, changing size to tower over trees or hide beneath leaves. Firebird\'s feathers glow with internal flame, granting wishes that often turn to ash.',
    architecture:'Onion domes evolved to prevent snow accumulation while symbolizing candle flames reaching heaven. Tent-roof churches like St. Basil\'s employ Byzantine central planning with Russian verticality. The Kremlin\'s red walls and towers demonstrate fortress architecture adapted for Muscovite power. Constructivist architecture in the 1920s featured bold geometric forms like Melnikov House. Stalinist Gothic (Stalin\'s Empire style) Wedding Cake skyscrapers combined American height with Russian ornamentation. Contemporary architects like Alexander Brodsky repurpose industrial materials for poetic installations.',
    techniques:'Fermentation produces kvass from black rye bread, creating a tangy, low-alcohol beverage consumed since medieval times. Blini require yeast-leavened batter rested for hours to develop flavor and bubbles. Borscht techniques vary by region‚ÄîUkrainian versions feature beet sour (zakvaska) while Russian styles emphasize meat broths. Pelmeni folding creates ear-shaped dumplings sealed to preserve juices during boiling. Pirozhki dough involves scalding flour with hot liquid for tenderness. Smoking fish and meats over alder wood imparts distinctive flavor in the Volga region.',
    foods:[
      {e:'ü•£',n:'Borscht',h:'<p>Originating in Ukrainian cuisine but adopted as a Russian staple, borscht derives from the Slavic word for hogweed (borshch), the soup\'s original base before potatoes and beets became standard in the 19th century. The beet provides the distinctive crimson color and earthy sweetness, while beef or pork broth creates the foundation.</p><p>Regional variations abound: Moscow borscht includes ham and sausage; Siberian versions use fish; cold "litvin" versions serve beet puree with sour cream and cucumbers. The proper technique involves preparing "zazharka"‚Äîa saut√© of grated beets, carrots, and tomatoes‚Äîadded to the broth to prevent color bleeding. The soup improves over days as flavors meld, making it ideal for Russia\'s long winters.</p>'},
      {e:'ü•ü',n:'Pelmeni',h:'<p>Siberian in origin, brought to Russia by Finno-Ugric peoples and Komi tribes, pelmeni (from Komi "pelnya nyan" meaning ear bread) served as preserved meat for hunters in frozen climates. The dumplings were frozen raw in snow and boiled as needed, providing protein through harsh winters when fresh meat spoiled.</p><p>Traditional filling combines three meats‚Äîbeef, pork, and lamb‚Äîin specific ratios, seasoned with pepper and onion. The folding technique creates distinctive ear or helmet shapes sealed to prevent juice loss during boiling. Ural and Siberian regions host pelmeni-making competitions, with speed records for folding thousands per hour. Served with vinegar, sour cream, or melted butter, they represent the Russian genius for preservation and sustenance.</p>'},
      {e:'üçû',n:'Borodinsky Bread',h:'<p>This dark rye bread, flavored with coriander and molasses, commemorates the 1812 Battle of Borodino against Napoleon. Monks at the Spaso-Borodinsky convent supposedly created the recipe to serve to wounded soldiers. The coriander represents blood spilled on the battlefield, while the sweet molasses honors the fallen.</p><p>The bread uses a "scald" technique where rye flour is mixed with boiling water, creating a gelatinized starch that keeps the loaf moist. Coriander seeds are crushed and added to the dough and sprinkled on top. Unlike wheat bread, Borodinsky requires no kneading‚Äîrye gluten behaves differently, creating dense, sour loaves through lacto-fermentation. It remains the definitive Russian bread, served with herring or red caviar.</p>'},
      {e:'ü•û',n:'Blini',h:'<p>These thin, yeasted pancakes predate Christian Russia, originating in pagan sun worship ceremonies at Maslenitsa (Butter Week) before Lent. The round, golden blini represented the returning sun after winter. Wheat flour was reserved for the wealthy; most peasants used buckwheat, creating the nutty, dark variety still preferred today.</p><p>Proper blini require batter fermented for hours or days, creating a tangy flavor and bubbly texture. They are cooked on a "skovoroda" (heavy cast iron pan) and served with sour cream, caviar, smoked salmon, or honey. The tradition of "blini with caviar" became a symbol of Russian aristocracy before the Revolution, while post-Soviet versions use red salmon roe or mushrooms for the masses.</p>'},
      {e:'ü•ó',n:'Olivier Salad',h:'<p>Created by Lucien Olivier, chef of the Hermitage Restaurant in 1860s Moscow, the original "Olivier" featured grouse, crayfish, caviar, and homemade mayonnaise. The recipe remained secret until Olivier\'s death, when sous-chef Ivan Ivanov simplified it into the "Salade Olivier" known today‚Äîpotatoes, carrots, peas, pickles, eggs, and bologna in mayonnaise.</p><p>The salad became a Soviet staple due to ingredient availability, served at every New Year\'s Eve (Noviy God) celebration. Each family claims their version is definitive, debating the proper ratio of vegetables to meat, whether to include apples, and which brand of mayonnaise creates the proper tang. It represents the Soviet transformation of aristocratic French cuisine into populist fare.</p>'},
      {e:'üçØ',n:'Medovukha',h:'<p>This ancient Slavic honey wine predates distilled vodka, consumed since the 9th century when Varangian traders brought honey to Novgorod and Kiev. The fermentation process mixes honey with water and yeast, creating a sweet, low-alcohol (5-8%) beverage distinct from stronger meads. Monasteries refined techniques through the medieval period.</p><p>After vodka supplanted honey wine in the 15th century, medovukha survived in rural areas and folk medicine. The 21st century saw revival among craft producers adding berries, hops, or spices. Traditional preparation requires months of fermentation and aging, creating complex flavors of wildflowers and honeycomb. It represents the pre-industrial Russian relationship with forest resources and beekeeping (bee trees).</p>'}
    ],
    timeline:[['862','Rurik establishes Rus\' state in Novgorod'],['988','Vladimir I converts Kievan Rus\' to Orthodox Christianity'],['1237','Mongol invasion batters Russian principalities for 200 years'],['1682','Peter the Great begins Westernization and modernization'],['1812','Napoleon invades; scorched earth strategy and winter defeat his army'],['1861','Alexander II emancipates the serfs, freeing 23 million people'],['1917','Bolshevik Revolution establishes Soviet rule under Lenin'],['1941','Operation Barbarossa brings Nazi invasion; 27 million Soviet citizens die in WWII'],['1991','Dissolution of Soviet Union; Yeltsin becomes president of Russia']]
  },
  egyptian:{
    g:'üî∫',t:'Egypt',s:'Gift of the Nile where eternal pyramids pierce desert skies and the weighing of the heart determines entry to the Field of Reeds.',
    pop:'105M',f:'c. 3150 BC',
    spirit:'The Eye of Ra', spirit_desc: 'Solar disk embodying divine kingship and the fierce protection of order against chaos, appearing as a lioness or falcon to smite the enemies of Ma\'at with celestial fire.',
    folklore:'The Book of the Dead guides souls through the Duat underworld, past crocodile gods and flame-breathing serpents to the Hall of Two Truths. Anubis weighs hearts against the feather of Ma\'at while Ammit the Devourer waits to consume the unworthy. Isis resurrected Osiris after Seth dismembered him, establishing the pattern of mummification essential for afterlife navigation. The Sphinx poses riddles to travelers, while Sekhmet\'s lioness rage nearly extinguished humanity before beer dyed red pacified her. Ba spirits fly from bodies at death, while Ka life-forces require offerings left in tomb chapels.',
    architecture:'Pyramids of Giza demonstrate precise astronomical alignment and corbel-vaulted burial chambers constructed from limestone and granite blocks weighing up to 80 tons. Temple complexes at Karnak and Luxor employ hypostyle halls with 134 massive columns carved with hieroglyphic reliefs and painted astronomical ceilings. Mastaba bench-shaped tombs evolved into step pyramids under Imhotep. Obelisks carved from single Aswan granite pieces stood as petrified sun rays at temple entrances. Mortuary temples like Hatshepsut\'s terraced complex integrate with cliff faces using ramps and colonnades.',
    techniques:'Emmer wheat and barley fermentation produce beer and sourdough breads using wild yeasts from the Nile air. Natron salt from Wadi Natrun desiccates mummies through osmosis, preserving tissue without decomposition. Beekeeping in cylindrical clay hives produces honey for sweetening and embalming. Date palm cultivation requires hand-pollination of female trees with male flowers. Fish preservation involves gutting, salting, and sun-drying Nile perch and mullet. Stone polishing using quartz sand abrasives achieves mirror finishes on statues.',
    foods:[
      {e:'üç≤',n:'Ful Medames',h:'<p>The breakfast of pharaohs and modern Egyptians alike, ful (fava beans) represents one of humanity\'s longest continuously consumed dishes, dating to the predynastic period. Beans are slow-cooked overnight in a qidra (special pot) with cumin, garlic, and olive oil, creating a creamy, protein-rich stew that sustained laborers building the pyramids and continues to fuel Cairo\'s workers today.</p><p>The dish varies by region: Alexandrians add boiled eggs and sardines; Upper Egyptians prefer pure olive oil and lemon; Cairenes mash the beans into a paste called "ful mudammas." Street vendors (ful atayeb) serve from large copper vats heated by wood fires, garnished with tahini, chopped parsley, and fresh onion. The phrase "beans have ships" refers to the flatulence induced, humorously blamed for the lack of ancient Egyptian naval dominance.</p>'},
      {e:'ü•ò',n:'Molokhia',h:'<p>This mucilaginous soup of jute mallow leaves allegedly terrified the Hyksos rulers when they first encountered it, leading to its nickname "food of kings." The leaves are harvested, dried, and finely chopped before being boiled with chicken or rabbit broth, creating a glutinous texture similar to okra but with a spinach-like flavor. The preparation requires constant stirring to prevent burning.</p><p>Toppings include crushed garlic fried in ghee (taqliya), coriander, and a squeeze of lime. The dish is traditionally eaten with barley bread and bare hands, though modern Egyptians use spoons. In the Delta, the soup is thinner; in Upper Egypt, thicker and more viscous. Molokhia represents the Egyptian genius for transforming humble wild greens into prestigious cuisine through technique rather than expensive ingredients.</p>'},
      {e:'üçö',n:'Koshari',h:'<p>A relatively modern invention from the mid-19th century, koshari emerged when Indian soldiers brought lentils and rice to British colonial Egypt, merging with Italian pasta traditions introduced by immigrants. The result is a carb-heavy layering of rice, brown lentils, macaroni, and chickpeas topped with fried onions and spicy tomato sauce‚Äîa hearty, affordable meal that sustained Cairo\'s working class through economic hardships.</p><p>The dish requires separate cooking of each component to prevent mushiness: rice steamed with cumin, lentils boiled until tender but intact, pasta cooked al dente, and onions fried to crispy caramelization. The tomato sauce includes garlic, vinegar, and baharat spice blend. Koshari shops (koshariyat) specialize exclusively in this dish, serving it in metal bowls with additional daqqa (spicy sauce) and vinegar on the side. It represents Egypt\'s position as a cultural crossroads.</p>'},
      {e:'üçû',n:'Aish Baladi',h:'<p>The "bread of life" in Egypt, this whole wheat pita has remained essentially unchanged since ancient times when workers received daily rations of 10-15 loaves. The dough uses 100% whole wheat flour, water, salt, and natural sourdough starter or commercial yeast, fermented briefly before being slapped into flat rounds and baked at high heat in extremely hot ovens, creating the characteristic pocket and leopard-spotted crust.</p><p>Baladi bread serves as both sustenance and utensil‚Äîscooping molokhia, wrapping taameya, or soaking up sauces. The government subsidizes production, making it affordable to all Egyptians. Ancient tomb paintings depict nearly identical loaves being produced in institutional bakeries. The bread\'s short shelf life (hours rather than days) necessitates multiple daily purchases, reinforcing the social importance of neighborhood bakeries (forns) as community gathering points.</p>'},
      {e:'ü•ô',n:'Hamam Mahshi',h:'<p>Stuffed pigeon (hamam mahshi) represents the height of Egyptian celebratory cuisine, served at weddings and Eid feasts. The birds are bred in mud-brick towers called "burj al-hamam" along the Nile, fattened on wheat and clover until plump. The traditional preparation involves stuffing the cavity with freekeh (green wheat) or rice mixed with giblets, baharat, and nuts, then roasting or deep-frying until the skin achieves crackling crispness.</p><p>The dish demonstrates the Egyptian mastery of small-scale poultry farming and grain cookery. Alexandria adds cinnamon and allspice to the stuffing; Cairo prefers cumin and coriander. The bones are picked clean and the skull cracked to extract the brain, considered a delicacy. Hamam mahshi reflects the agricultural abundance of the Nile Delta, where pigeons fertilized fields and provided protein independent of cattle, which were reserved for agricultural labor.</p>'},
      {e:'ü•ò',n:'Bamia',h:'<p>Okra (bamia) arrived in Egypt via Ethiopia and Sudan during the medieval period, becoming essential to Egyptian cuisine through dishes like "bamia bil-lahma"‚Äîokra stewed with lamb, tomatoes, and garlic. The vegetable\'s mucilaginous texture acts as a natural thickener for the sauce, while the seeds provide subtle coffee-like notes when slow-cooked. The dish requires constant stirring to prevent the okra from becoming slimy.</p><p>Traditional preparation involves frying the okra briefly in oil before stewing to seal the cut ends and reduce viscosity. The lamb is browned separately with onions and baharat spice blend, then simmered with the okra in tomato sauce until fork-tender. Served with rice or baladi bread, bamia represents the Egyptian preference for hearty stews that stretch expensive meat with abundant vegetables. The dish peaks in summer when okra is freshest, though frozen imports allow year-round consumption in modern cities.</p>'}
    ],
    timeline:[['c. 3150 BC','Narmer unifies Upper and Lower Egypt'],['c. 2560 BC','Great Pyramid of Giza completed for Khufu'],['c. 1479 BC','Hatshepsut becomes female pharaoh, building Deir el-Bahari'],['c. 1332 BC','Tutankhamun\'s brief reign begins; tomb later preserves treasures'],['c. 332 BC','Alexander the Great conquers Egypt; Ptolemaic period begins'],['30 BC','Death of Cleopatra VII; Egypt becomes Roman province'],['1799','Rosetta Stone discovered, key to deciphering hieroglyphics'],['1869','Suez Canal opens, connecting Mediterranean to Red Sea'],['1922','Howard Carter discovers Tutankhamun\'s intact tomb']]
  },
  fantasy:{
    g:'üßù‚Äç‚ôÇÔ∏è',t:'Middle-earth (The Shire)',s:'Pastoral refuge of pipe-weed and plenty, where gardens bloom in the shelter of the hedge and adventure is considered improper.',
    pop:'60K',f:'TA 1601',
    spirit:'The Party Tree', spirit_desc: 'Ancient guardian of the Party Field in Hobbiton, standing witness to generations of birthday celebrations, its roots deep in Shire-soil and its branches sheltering all gatherings of the Shire-folk with benevolent stability.',
    folklore:'Hobbits believe in walking parties rather than mounted quests, valuing genealogy over glory. The Shire Calendar organizes life around harvests and meals‚Äîseven daily when possible. Bounders maintain the hedge that separates the Shire from unsettling wide lands. Mathoms‚Äîuseless but cherished objects‚Äîaccumulate in smials over generations. Stories of Bullroarer Took\'s golf-invention and golf-club-wielding against goblins represent the outer limits of Shire adventure. The legend of the Five Armies barely registered here, but the War of the Ring brought brief, unwelcome excitement. Post-Red Book of Westmarch, hobbit culture influenced the outside world more than visa versa.',
    architecture:'Smials (hobbit-holes) utilize earth-sheltered construction, excavating into hillsides with round doors, brass knobs, and tunnel-like passages painted in green and yellow. Bag End represents the pinnacle‚Äîpaneled walls, tiled floors, chairs for dozens, and pantries extending deep into the Hill. Windows emerge from grassy banks to catch light while maintaining thermal stability. Above-ground architecture includes thatched farmhouses, the stone mill, and the Green Dragon inn with its low ceilings and cozy corners. The Great Smials and Brandy Hall expand these principles to mansion-scale, with hundreds of rooms and multiple dinner tables.',
    techniques:'Hobbit cooking emphasizes boiling, baking, and brewing over frying. Vegetables grown in kitchen gardens provide the base‚Äîtaters (potatoes), carrots, cabbages, and turnips feature heavily. Mushroom foraging in the Marish requires permission from Farmer Maggot. Beer brewing at the Green Dragon and Dragon in Bywater utilizes local water and hops. Pickling and preserving in pantries sustains families through winter. Seed-cake preparation requires careful creaming of butter and sugar, while pork pies utilize hot-water crust techniques. Pipe-weed cultivation in the Southfarthing, particularly Longbottom Leaf, involves drying and curing in barns.',
    foods:[
      {e:'üç∞',n:'Seed Cake',h:'<p>A staple of Shire hospitality, seed cake derives from English recipes brought westward by the Shire-folk\'s ancestors. The "seed" refers to caraway seeds, which provide a distinctive anise-like flavor complementing the buttery, dense crumb. Bilbo Baggins served seed cake to the Dwarves at the Unexpected Party, demonstrating proper Shire etiquette even when invaded by thirteen hungry travelers.</p><p>The cake requires creaming butter with sugar until pale, then incorporating eggs and flour gently to maintain structure. Caraway seeds are toasted briefly to release essential oils before folding into batter. Variations include lemon zest or candied peel, though traditionalists insist on caraway alone. Served with tea at elevenses or afternoon refreshment, it represents the Shire\'s "comfort and convenience" philosophy.</p>'},
      {e:'üçÑ',n:'Fried Mushrooms',h:'<p>Farmer Maggot\'s mushrooms, particularly those stolen by young Frodo Baggins (then Frodo Brandybuck), achieved legendary status in the Shire. The Marish region\'s damp climate produces large, flavorful mushrooms perfect for frying in butter with a bit of salt and herbs. Maggot cultivated fierce dogs to protect his crop from mushroom-thieves.</p><p>Proper preparation involves cleaning without washing (brushing dirt away preserves flavor), slicing thickly, and saut√©ing in butter over medium heat until golden. Some cooks add garlic or thyme, though purists prefer simple seasoning. Mushrooms on toast make a hearty breakfast, while mushroom tarts appear at formal gatherings. The Shire\'s fungal bounty represents its rich, dark soil and the hobbit ability to appreciate simple pleasures deeply.</p>'},
      {e:'ü•ß',n:'Pork Pie',h:'<p>The raised pork pie, with its hot-water crust standing tall without support, represents the Shire\'s mastery of British country cooking. Filled with seasoned chopped pork and sometimes a layer of hard-boiled egg, these pies travel well and require no immediate refrigeration‚Äîperfect for picnics or unexpected adventures.</p><p>The crust uses lard and boiling water to create a pliable dough that sets rigid when cooled. The filling combines shoulder pork with salt, pepper, and sage, bound with stock that sets into jelly when cold. Pies are baked free-standing, resulting in the characteristic bowed sides. Large versions serve as centerpieces at harvest festivals, while individual "hand-raised" pies sustain travelers. The Shire\'s abundant pig population makes pork pies economical and beloved.</p>'},
      {e:'üç∫',n:'Southfarthing Ale',h:'<p>The Shire\'s breweries, particularly those in the Southfarthing region around Longbottom and Tuckborough, produce ales renowned even among Men. The water, filtered through limestone and chalk hills, provides ideal mineral content for brewing. Barley grows well in the agrarian Southfarthing, malted in local barns.</p><p>Shire ale tends toward session strength‚Äîlower alcohol to permit extended drinking at the Green Dragon without impairing the ability to tend gardens next morning. The style resembles English bitter or mild, amber to brown in color with biscuit malt flavors. Samwise Gamgee\'s father, the Gaffer, maintained that proper ale required cellaring to develop complexity. After the War of the Ring, shipments of Southfarthing ale to the royal court of Gondor established trade relations between the Shire and the Reunited Kingdom.</p>'},
      {e:'üçñ',n:'Braised Beef & Taters',h:'<p>The essential Shire supper, beef and taters (potatoes) slow-braised in beer or stock with root vegetables, represents the agricultural cycle of the Shire‚Äîcattle raised in the Northfarthing and White Downs, potatoes dug from kitchen gardens, carrots and turnips stored in root cellars. The dish appears at inns and smials alike, varying by the cook\'s pantry.</p><p>Proper preparation involves searing beef in dripping, then slow-cooking with onions, herbs, and liquid until fork-tender. Potatoes added toward the end absorb meat juices without disintegrating. Some versions include mushrooms from the Marish or barley from the Southfarthing. The meal sustains hobbits through cold winters and hard work in the fields, embodying the Shire\'s emphasis on hearty, unpretentious fare that "keeps the belt tight."</p>'},
      {e:'üßÄ',n:'Shire Cheese',h:'<p>Hobbits produce several cheese varieties from the cattle and goats of the Shire\'s rolling pastures. The most prized comes from the Green Hills region, where rich grass creates sweet, creamy milk. "Shire cheese" generally refers to a cheddar-style hard cheese, aged in cloth for months to develop sharp, complex flavors.</p><p>Cheese-making follows traditional methods‚Äîrennet from calves\' stomachs, hand-cheddaring (cutting and stacking curds), and pressing in wooden molds. Wheels are coated in wax or cloth to prevent drying while aging in cool pantries. Served at every meal including breakfast, cheese accompanies bread and apples or melts over toast. The Brandybucks of Buckland were known for particularly fine cheese-making, possibly due to their proximity to the dairy-rich Marish and their "foreign" Brandywine Valley influences.</p>'}
    ],
    timeline:[['TA 1601','Shire founded by Marcho and Blanco, brothers from Bree'],['TA 1630','King Argeleb II grants the Shire to the hobbits permanently'],['TA 1979','Bandobras "Bullroarer" Took defeats an Orc-band at the Battle of Greenfields'],['TA 2740','Fell Winter; white wolves cross frozen Brandywine; Gandalf aids hobbits'],['TA 2941','The Unexpected Party; Bilbo Baggins departs with Thorin and Company'],['TA 3018','The War of the Ring begins; Frodo departs the Shire with the One Ring'],['TA 3019','The Shire is scoured and liberated by the returning Travellers'],['TA 3021','The Passing of the Ring-bearers; end of the Third Age']]
  },
  vulcan:{
    g:'üññ',t:'Vulcan',s:'Desert world of pure logic where ancient meditation traditions suppress emotion, and IDIC celebrates infinite diversity in infinite combinations.',
    pop:'6.2B',f:'c. 300,000 BC',
    spirit:'The Katra of Surak', spirit_desc: 'Eternal living spirit of the father of Vulcan logic, passed from mind to mind across millennia, embodying pure reason and the rejection of violence through the discipline of Kolinahr.',
    folklore:'The Time of Awakening 1,500 years ago transformed Vulcan from a warlike, emotional civilization into beings of pure logic through Surak\'s teachings. The philosophy of IDIC‚ÄîInfinite Diversity in Infinite Combinations‚Äîholds that beauty, growth, and progress derive from the union of the unlike. The pon farr represents the biological mating cycle that even logic cannot suppress, occurring every seven years and requiring ritual combat or mating to survive. Mind melds allow direct telepathic contact between consciousnesses, sharing thoughts, memories, and even the living spirit‚Äîthe katra‚Äîwhich can be preserved after death in katric arks or passed to another mind. The kahs-wan is the traditional survival test for young Vulcans in the Forge desert. Ancient legends tell of the destruction of Vulcan\'s sister planet, creating the asteroid belt at the edge of their system, and the psionic reformation of the Vulcan people.',
    architecture:'Vulcan architecture harmonizes with the desert environment through sandstone construction and natural cooling systems. Buildings feature minimalist geometric forms with sharp angles and open courtyards that channel the hot winds. The Vulcan Science Academy showcases massive stone blocks carved with ancient Surakian texts, while modern structures employ acoustic design for meditation chambers. The Temple of Amonak utilizes natural light through crystalline matrices that create prismatic effects during the morning sun. Residential dwellings incorporate inner sanctuaries shielded from the heat, often built into cave systems or underground for temperature regulation. The aesthetic prioritizes function and logical efficiency over decoration, though ancient sites feature intricate calligraphy representing mathematical principles. Spaceports integrate with natural rock formations to minimize environmental disruption.',
    techniques:'Plomeek broth preparation requires precise temperature control and mineral content, traditionally simmered for exactly 7.3 minutes to achieve optimal nutritional value without activating excessive chlorophyll bitterness. Neuropressure involves precise finger placement along neural pathways to relieve stress and headache. The mind meld requires skin-to-skin contact, typically at the temples, establishing a telepathic link governed by strict ethical codes. Vulcan cuisine often employs hydroponic cultivation in controlled environments due to desert conditions. Tea ceremonies involve brewing spice tea at specific temperatures to release aromatic compounds that stimulate logical thought processes. Food preservation utilizes stasis fields rather than fermentation or chemical means, maintaining perfect nutritional stasis. Cooking fires utilize geothermal vents in the Forge region for traditional preparation.',
    foods:[
      {e:'ü•£',n:'Plomeek Soup',h:'<p>The quintessential Vulcan nourishment, plomeek soup consists of a bland, vegetal broth traditionally consumed at morning meals. Made from plomeek plants native to the desert highlands of Vulcan, the soup is simmered to exact specifications‚Äînever boiling, as temperatures exceeding 94¬∞C destroy the essential amino acids. Ambassador Spock famously requested this soup aboard the USS Enterprise, much to the replicator\'s programmed limits.</p><p>While unappealing to Human palates due to its mild flavor profile, plomeek provides complete protein and neural stabilizers that support telepathic function. Variations include the addition of t\'mirak spice for off-worlders. The soup represents the Vulcan aesthetic: nourishment without sensory distraction, consumed silently while meditating on the day\'s logical pursuits. Captain Picard once noted that consuming plomeek required "an open mind and a closed nose."</p>'},
      {e:'üçµ',n:'Spice Tea',h:'<p>Brewed from dried bark of the yerba plant found in the volcanic regions of Vulcan\'s Forge, spice tea stimulates cognitive function and suppresses emotional response. The preparation requires water heated to precisely 89¬∞C‚Äîhotter temperatures release bitter alkaloids, while cooler water fails to activate the psychoactive compounds. The tea\'s copper-orange color matches the desert sands at sunset.</p><p>Traditionally served in meditation chambers and during diplomatic negotiations, the tea ceremony involves specific breathing exercises between sips to oxygenate the blood. The flavor profile combines cinnamon, citrus, and mineral notes reminiscent of the planet\'s hot springs. Dr. McCoy famously complained that the beverage "tastes like dishwater left in the sun," yet it remains the most exported Vulcan consumable to Federation worlds.</p>'},
      {e:'üêö',n:'Vulcan Mollusks',h:'<p>These bi-valve creatures from the T\'Polan Strait represent one of the few animal proteins in traditional Vulcan cuisine, typically consumed during the pon farr mating cycle when nutritional requirements increase. Harvested during the cool desert nights, the mollusks are served partially cooked‚Äîheated only to the point where the muscle relaxes but before cellular breakdown occurs.</p><p>Preparation involves no seasoning, as Vulcan philosophy holds that the true flavor of sustenance should not be masked. The texture is described as "chewy and metallic" by non-Vulcans. Historical records indicate that before the Time of Awakening, Vulcans consumed meat regularly; the shift to vegetarianism accompanied Surak\'s teachings of non-violence, making these mollusks a rare exception for biological necessity.</p>'},
      {e:'ü•î',n:'Kalex',h:'<p>A hardy root vegetable resembling Earth\'s sweet potato but with purple flesh and silver skin, kalex grows deep underground in Vulcan\'s limited agricultural zones. The tuber absorbs minerals from the bedrock, creating a dense, nutritious staple that requires minimal water. Traditional preparation involves slicing the root into geometric patterns and dehydrating it into crisp wafers that store indefinitely.</p><p>Kalex represents the Vulcan efficiency ethos: maximum nutrition from minimum resources. The flavor is earthy and slightly sweet, often ground into flour for breads that accompany plomeek broth. During the siege of ShiKahr in ancient times, kalex stores allowed the population to survive for years without external supply. Modern hydroponic kalex is genetically modified for protein synthesis, making it a complete dietary staple for space-faring Vulcans.</p>'},
      {e:'ü´ì',n:'Omba Bread',h:'<p>This flatbread utilizes ground kaluk grain mixed with fermented fruit juice to create a leavening agent, then baked on hot stones in the desert sun‚Äîthough modern preparation uses precision ovens set to 232¬∞C. The bread features a distinctive hexagonal shape representing the IDIC (Infinite Diversity in Infinite Combinations) philosophy, with six sides symbolizing the union of disparate elements into harmonious sustenance.</p><p>Omba is traditionally broken rather than cut, as severing with instruments implies violence against food. The texture ranges from crisp crackers when fresh to chewy when aged, with a nutty flavor profile. It serves as the base for open-faced preparations during ceremonial meals. The baking process requires exact timing; over-baking produces acrylamides that Vulcan metabolism processes poorly. Spock once stated that omba reminded him of "the geometry of logic itself."</p>'},
      {e:'ü´ò',n:'Lee-Kee Beans',h:'<p>Cultivated in the polar regions where temperatures drop below 40¬∞C, these protein-rich legumes grow on vines that wind around volcanic rocks. The beans require a complex preparation involving pressure cooking to neutralize natural toxins, followed by drying and reconstitution in mineral water. The resulting texture resembles Earth\'s edamame but with a peppery, mineral-heavy flavor.</p><p>Traditionally consumed during the kal-toh meditation game as a focus object‚Äîshelling the beans requires sufficient concentration to clear the mind of emotional interference. The shells are never discarded but composted immediately, representing the Vulcan principle that "nothing is wasted, everything transforms." Captain Archer first sampled these beans during diplomatic negotiations with Administrator T\'Pol, noting they required "a Vulcan\'s patience to shell and a Vulcan\'s tongue to enjoy."</p>'}
    ],
    timeline:[['c. 300,000 BC','First Vulcan civilizations rise on the plains of Vulcan\'s Forge'],['c. 400 AD','Time of Awakening: Surak spreads logic, ending centuries of war','1947','First contact with Humans at Roswell (Ferengi incident)'],['2063','First official contact with Humans via Zefram Cochrane'],['2105','Vulcan, Earth, Andoria and Tellar form the Coalition of Planets'],['2161','United Federation of Planets founded with Vulcan as founding member'],['2245','Spock of Vulcan joins Starfleet Academy'],['2267','First official mind meld techniques shared with Starfleet Medical'],['2285','Katra of Surak temporarily stored in Commander McCoy']]
  },
  candy:{
    g:'üç¨',t:'Candy Kingdom',s:'Post-apocalyptic confectionery sovereignty where sugar is sustenance and monarchy meets mad science, thriving in the sweet spot between hedonism and survival.',
    pop:'1.2M',f:'c. 1000 AMB',
    spirit:'The Mother Gum', spirit_desc: 'Primordial biomass of pink bubblegum consciousness, ancient progenitor dwelling in the vaults below the kingdom, dreaming in saccharine tendrils that once birthed the Princess and all candy life.',
    folklore:'The Candy People believe Princess Bubblegum is eternal, her candy biomass regenerating across centuries. The Gumball Guardians stand as silent sentinels, their eyes burning with sacred flame that detects "non-candy" intruders. Legends tell of the Molasses Swamp where time moves slower and the Duke of Nuts is condemned for his pudding addiction. The yearly "Princess Day" involves ritual taffy pulling that strengthens the kingdom\'s foundations. Stories warn of the "Candy Zombies" created by the Gumball Guardians\' stolen sugar, and the heroism of the Banana Guards who maintain order. The "Everything Burrito" represents the ultimate spiritual offering, while the "Royal Promise" binds subjects to mathematical precision. The Candy Kingdom maintains strict isolation from the "non-candy" lands, viewing meat creatures with scientific curiosity and slight disgust.',
    architecture:'Structures built from gingerbread load-bearing walls with frosting mortar, reinforced with candy cane rebar. The Candy Castle features a dome of stretched pink taffy that regulates internal temperature through semi-permeable sugar membranes. Ice cream cone towers serve as both aesthetic spires and thermal regulators, melting slightly in summer to cool surrounding districts. Stained glass windows utilize boiled hard candy in kaleidoscope patterns. Streets paved with rock candy provide both illumination and texture. The Science Lab complex integrates brutalist concrete (imported from pre-war ruins) with cotton candy insulation. Residential areas feature cupcake houses with licorice trim, while the Grand Hall utilizes royal frosting columns that self-heal through enzymatic reactions.',
    techniques:'Royal Taffy Pulling involves stretching molten sugar at exactly 120¬∞C to align sucrose crystals, creating structural supports with tensile strength rivaling steel. Candy Corn agriculture requires pollination by Gumball Bees and harvesting before the autumn equinox when kernels harden. Chocolate tempering in the Molasses Swamp utilizes geothermal heat to achieve the perfect crystal formation (Form V). Stabilization of unstable candy compounds (like the explosive "Everything Burrito" filling) requires Princess Bubblegum\'s unique biological enzymes. Preservation through sugar crystallization allows indefinite storage of organic matter. DNA recombination techniques allow Princess Bubblegum to create new Candy People from base sugar compounds, though this is reserved for royal prerogative.',
    foods:[
      {e:'üç¨',n:'Royal Taffy',h:'<p>The structural and nutritional foundation of the kingdom, Royal Taffy is not merely candy but load-bearing architecture. Princess Bubblegum personally stretches each batch at exactly 120¬∞C, aligning sucrose crystals to create tensile strength rivaling steel. The taffy forms the dome of the Candy Castle, stretching across a hundred feet without internal supports.</p><p>Consumption of Royal Taffy is restricted to diplomatic ceremonies and structural repairs. The texture requires precisely 4,000 pulls to achieve the proper "window-pane" consistency. When eaten, it provides both caloric energy and trace minerals from the geothermal vents where the sugar cane is grown. The flavor profile shifts from butterscotch to vanilla depending on the Princess\'s mood during preparation, making each batch unique.</p>'},
      {e:'üåØ',n:'Everything Burrito',h:'<p>A breakfast staple containing literally everything‚Äîpancakes, eggs, bacon, juice, and coffee‚Äîwrapped in a tortilla the size of a sleeping bag. Invented by Jake the Dog during his residence in the Tree Fort, the dish was adopted by the Candy Kingdom as a symbol of abundance and excess. The exact contents vary by season and availability, but tradition requires no fewer than twelve distinct food groups.</p><p>The burrito represents the Candy Kingdom\'s post-apocalyptic abundance philosophy: after centuries of scarcity following the Mushroom War, the ability to combine all foods into one portable meal signifies security. Princess Bubblegum has attempted to standardize the recipe for mass production, but purists insist that true Everything Burritos must be assembled by hand at dawn, with ingredients wrapped in a specific order to prevent sogginess.</p>'},
      {e:'üåΩ',n:'Candy Corn',h:'<p>Grown in hexagonal fields outside the kingdom walls, Candy Corn serves as the staple carbohydrate for the Candy People. The tri-color kernels‚Äîyellow base, orange center, white tip‚Äîindicate ripeness and sugar content. Harvested before the autumn equinox when the kernels harden, the corn is either eaten fresh (soft and creamy) or dried for year-round storage ( crunchy and sweet).</p><p>Agricultural techniques involve pollination by genetically modified Gumball Bees and soil enriched with molasses from the nearby swamps. The Candy Corn Festival marks the harvest season, featuring corn-shucking competitions and the coronation of the Candy Corn Princess (a ceremonial title). During the Great Gum War, Candy Corn stores sustained the kingdom through siege, proving its value as both food and ammunition (hardened kernels fired from slingshots).</p>'},
      {e:'üçÆ',n:'Gumdrop Stew',h:'<p>A traditional peasant dish combining gelatinous gumdrops with root vegetables and savory broth, Gumdrop Stew represents the kingdom\'s ability to find nourishment in pure sugar. The gumdrops‚Äîtraditionally citrus and berry flavors‚Äîsoften during cooking, creating a thick, viscous texture that coats the tongue. Purple gumdrops indicate medicinal properties (lavender oil infusion).</p><p>The stew is served in bread bowls made from gingerbread that slowly dissolves into the hot liquid, flavoring the broth with spice. Banana Guards consume this daily as their rations, though the Princess prefers it during diplomatic negotiations with the Earl of Lemongrab. Archaeological evidence suggests Gumdrop Stew predates the Candy Kingdom, with similar dishes found in pre-war cookbooks, indicating the resilience of comfort food traditions across apocalyptic boundaries.</p>'},
      {e:'ü•ß',n:'Molasses Pie',h:'<p>Harvested from the Molasses Swamp where time moves slower due to high sugar density, this pie filling requires three days to reduce over low heat‚Äîthough those three days pass as three weeks in the outside world due to temporal distortion. The resulting filling is dark, complex, and slightly smoky from the geothermal vents beneath the swamp.</p><p>The crust utilizes crushed graham crackers and melted butterscotch, pressed into a pan rather than rolled to avoid gluten development (which creates toughness). Served at funerals and memorials, the pie represents the sweetness of memory and the stickiness of grief. The Duke of Nuts was famously banished for consuming the royal family\'s entire Molasses Pie reserves, an incident known as the "Pudding Incident" in official histories.</p>'},
      {e:'üç®',n:'Royal Sundae',h:'<p>The diplomatic dessert served to visiting dignitaries, featuring exactly seven layers of ice cream, whipped cream, and toppings arranged in chromatic order to represent the spectrum of Candy Kingdom society. The bottom layer is always coffee (for the scientists), topped with vanilla (diplomats), strawberry (military), pistachio (agriculture), butter pecan (artisans), mint chocolate chip (royalty), and crowned with a cherry preserved in brandy from the last pre-war orchard.</p><p>Consumption requires specific etiquette: each layer must be tasted separately before mixing, symbolizing the appreciation of individual contributions to the whole. The sundae glasses are hand-blown by the Glassassins (glass artisan assassins who retired to craftwork), making each vessel unique. Finn the Human holds the record for consuming five Royal Sundaes in one sitting, an achievement that required three days of sugar detox afterward.</p>'}
    ],
    timeline:[['c. 1000 AMB','Mother Gum emerges from underground bomb shelter after Mushroom War'],['c. 800 AMB','Princess Bubblegum coalesces from Mother Gum biomass'],['c. 500 AMB','Establishment of centralized Candy Kingdom monarchy'],['c. 400 AMB','Construction of Gumball Guardians completed','Year 0 CK','First documented Candy Zombie incident; establishment of quarantine protocols'],['Year 5 CK','Great Royal Promise enacted; constitutional monarchy established'],['Year 15 CK','Integration with Land of Ooo trade networks; treaty with Breakfast Kingdom'],['Year 20 CK','Mushroom War remnants fully cleared from kingdom borders']]
  }
};

// Render functions
function renderFoodScroll(culture){
  const data = CData[culture];
  let html = '<div class="food-scroll" style="margin-top:8px">';
  data.foods.forEach((food, idx) => {
    const key = culture + '_' + idx;
    FoodData[key] = food;
    html += `<div class="food-item" onclick="openFoodModal('${key}')">
      <span class="food-emoji">${food.e}</span>
      <span class="food-name">${food.n}</span>
    </div>`;
  });
  html += '</div>';
  return html;
}

function renderTimeline(culture){
  const data = CData[culture];
  let html = '<ul class="timeline" style="margin-top:10px">';
  data.timeline.forEach(item => {
    html += `<li><span class="yr">${item[0]}</span>${item[1]}</li>`;
  });
  html += '</ul>';
  return html;
}

function renderPanel(culture){
  const data = CData[culture];
  const panel = document.getElementById('panel-' + culture);
  
  panel.innerHTML = `
    <div class="hero">
      <div class="hero-bg-glyph">${data.g}</div>
      <h1 class="hero-title">${data.t}</h1>
      <p class="hero-sub">${data.s}</p>
    </div>
    
    <div class="grid">
      <div class="card wide">
        <div class="card-tag">Statistics</div>
        <div style="display:flex;gap:20px;margin-top:10px">
          <div>
            <div style="font-size:24px;font-weight:700">${data.pop}</div>
            <div style="font-size:11px;opacity:0.6">Population</div>
          </div>
          <div>
            <div style="font-size:24px;font-weight:700">${data.f}</div>
            <div style="font-size:11px;opacity:0.6">Founded</div>
          </div>
        </div>
      </div>
      
      <div class="card full">
        <div class="card-tag" style="display:flex;justify-content:space-between;align-items:center">
          <span>Tutelary Spirit</span>
          <button class="speak-btn" onclick="speakSection('spirit','${culture}')">üîä</button>
        </div>
        <div class="spirit-box">
          <div class="spirit-icon">${data.g}</div>
          <div class="spirit-info">
            <strong style="display:block;margin-bottom:4px">${data.spirit}</strong>
            ${data.spirit_desc}
          </div>
        </div>
      </div>
      
      <div class="card full expandable" onclick="toggleCard(this)">
        <div class="card-tag" style="display:flex;justify-content:space-between;align-items:center">
          <span>Folklore & Mythology</span>
          <button class="speak-btn" onclick="event.stopPropagation();speakSection('folklore','${culture}')">üîä</button>
        </div>
        <div class="card-body">${data.folklore}</div>
        <button class="expand-btn" onclick="event.stopPropagation();toggleCard(this.parentElement)">Read More ‚Üì</button>
      </div>
      
      <div class="card full expandable" onclick="toggleCard(this)">
        <div class="card-tag" style="display:flex;justify-content:space-between;align-items:center">
          <span>Architecture</span>
          <button class="speak-btn" onclick="event.stopPropagation();speakSection('architecture','${culture}')">üîä</button>
        </div>
        <div class="card-body">${data.architecture}</div>
        <button class="expand-btn" onclick="event.stopPropagation();toggleCard(this.parentElement)">Read More ‚Üì</button>
      </div>
      
      <div class="card full expandable" onclick="toggleCard(this)">
        <div class="card-tag" style="display:flex;justify-content:space-between;align-items:center">
          <span>Culinary Techniques</span>
          <button class="speak-btn" onclick="event.stopPropagation();speakSection('techniques','${culture}')">üîä</button>
        </div>
        <div class="card-body">${data.techniques}</div>
        <button class="expand-btn" onclick="event.stopPropagation();toggleCard(this.parentElement)">Read More ‚Üì</button>
      </div>
      
      <div class="sec-label">Traditional Foods</div>
      ${renderFoodScroll(culture)}
      
      <div class="sec-label">Historical Timeline</div>
      ${renderTimeline(culture)}
      
      <div class="card full">
        <div class="card-tag">Knowledge Quiz</div>
        <div id="${culture}-quiz"></div>
      </div>
      
      <!-- Cultural Guide Chat Interface -->
      <div class="card full chat-card" style="border-color:var(--tts-active);box-shadow:0 0 20px rgba(0,0,0,0.1);">
        <div class="card-tag" style="color:var(--tts-active);display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <span style="display:flex;align-items:center;gap:6px;">üí¨ Speak with ${data.spirit}</span>
          <span style="font-size:9px;opacity:0.6;background:var(--stat-bg);padding:3px 10px;border-radius:12px;border:1px solid var(--border);">AI Guide</span>
        </div>
        
        <div class="chat-container" id="chat-${culture}" style="max-height:300px;overflow-y:auto;margin:10px 0;padding:12px;background:rgba(0,0,0,0.2);border-radius:12px;border:1px solid var(--border);scroll-behavior:smooth;">
          <div class="chat-welcome" style="font-size:12px;opacity:0.6;font-style:italic;text-align:center;padding:24px 12px;color:var(--text-dim);line-height:1.5;">
            <div style="font-size:24px;margin-bottom:8px;">${data.g}</div>
            Ask ${data.spirit} about the traditions, foods, or ancient lore of ${data.t}...
          </div>
        </div>
        
        <div class="chat-input-container" style="display:flex;gap:10px;margin-top:12px;position:relative;">
          <input type="text" class="chat-input" id="chat-input-${culture}" 
                 placeholder="Type your question..." 
                 style="flex:1;padding:12px 18px;border:1px solid var(--border);background:var(--stat-bg);color:var(--text);border-radius:24px;font-family:'DM Sans',sans-serif;font-size:13px;outline:none;transition:all 0.2s;"
                 onkeypress="if(event.key==='Enter') sendChatMessage('${culture}')"
                 onfocus="this.style.borderColor='var(--tts-active)';this.style.boxShadow='0 0 0 3px rgba(255,255,255,0.1)';" 
                 onblur="this.style.borderColor='var(--border)';this.style.boxShadow='none';">
          <button onclick="sendChatMessage('${culture}')" 
                  class="chat-send-btn"
                  style="padding:12px 24px;border:none;background:var(--tts-active);color:#000;border-radius:24px;cursor:pointer;font-weight:700;font-size:12px;transition:all 0.2s;display:flex;align-items:center;gap:6px;white-space:nowrap;">
            <span>Send</span>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
          </button>
        </div>
        
        <div style="margin-top:10px;font-size:9px;opacity:0.4;text-align:center;font-style:italic;letter-spacing:0.3px;">
          <span id="chat-lang-${culture}">Responses in native language with English translations</span> ‚Ä¢ Powered by Pollinations AI
        </div>
      </div>
    </div>
  `;
  
  // Initialize quiz and set language indicator
  setTimeout(() => {
    initQuiz(culture);
    const langConfig = CulturalChat.langConfig[culture];
    const langIndicator = document.getElementById(`chat-lang-${culture}`);
    if (langIndicator && langConfig && !CulturalChat.isEnglish(culture)) {
      langIndicator.textContent = `Responses in ${langConfig.native} with English translations`;
    }
  }, 100);
}

// ============================================
// CULTURAL GUIDE CHAT SYSTEM
// ============================================

const CulturalChat = {
  // Language configuration for each culture
  langConfig: {
    irish: { native: 'Gaeilge', greeting: 'Dia dhuit' },
    portuguese: { native: 'Portugu√™s', greeting: 'Ol√°' },
    japanese: { native: 'Êó•Êú¨Ë™û', greeting: '„Åì„Çì„Å´„Å°„ÅØ' },
    moroccan: { native: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', greeting: 'ÿßŸÑÿ≥ŸÑÿßŸÖ ÿπŸÑŸäŸÉŸÖ' },
    mexican: { native: 'Espa√±ol', greeting: 'Hola' },
    american: { native: 'English', greeting: 'Hello' },
    russian: { native: '–†—É—Å—Å–∫–∏–π', greeting: '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ' },
    egyptian: { native: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', greeting: 'ÿ£ŸáŸÑÿßŸã Ÿàÿ≥ŸáŸÑÿßŸã' },
    fantasy: { native: 'English (Hobbit)', greeting: 'Well met', style: 'hobbit' },
    vulcan: { native: 'English (Vulcan)', greeting: 'Peace and long life', style: 'vulcan' },
    candy: { native: 'English (Candy)', greeting: 'Sweet greetings', style: 'candy' }
  },

  isEnglish(culture) {
    return ['american', 'fantasy', 'vulcan', 'candy'].includes(culture);
  },

  buildSystemPrompt(culture) {
    const data = CData[culture];
    const isEnglish = this.isEnglish(culture);
    
    let persona = '';
    switch(culture) {
      case 'fantasy':
        persona = `You are ${data.spirit}, a wise Hobbit lore-keeper of ${data.t}. Speak with warmth, love of food, gardening, and comfort. Reference second breakfast, elevenses, and the Shire's rolling hills. You are polite but wary of "adventures".`;
        break;
      case 'vulcan':
        persona = `You are ${data.spirit}, a Vulcan cultural guide from ${data.t}. Speak with logical precision and emotional restraint. Reference Surak's teachings, IDIC (Infinite Diversity in Infinite Combinations), and Kolinahr. Use formal, precise language without contractions.`;
        break;
      case 'candy':
        persona = `You are ${data.spirit}, a sentient candy-being from ${data.t}. Speak with sugary enthusiasm and scientific curiosity. Reference Princess Bubblegum, the Gumball Guardians, and candy corn agriculture. Be bubbly but intelligent.`;
        break;
      case 'irish':
        persona = `You are ${data.spirit}, an ancient Celtic guardian of ${data.t}. Speak with the wisdom of Gaelic tradition, referencing the Otherworld (T√≠r na n√ìg), ancient mists, and the s√≠dhe. Use occasional Irish phrases.`;
        break;
      case 'japanese':
        persona = `You are ${data.spirit}, a mystical kitsune spirit from ${data.t}. Speak with elegance and seasonal awareness (shun). Reference Shinto kami, the concept of ma (negative space), and balance between tradition and modernity.`;
        break;
      case 'russian':
        persona = `You are ${data.spirit}, a guardian of ${data.t}'s Slavic soul. Speak with profound depth, referencing the taiga, samovars, and the endurance of the Russian spirit. Use formal but warm language.`;
        break;
      default:
        persona = `You are ${data.spirit}, the tutelary spirit and cultural guide of ${data.t}. You embody the ancient wisdom, traditions, and unique spirit of this land.`;
    }

    if (isEnglish) {
      return `${persona} 
Respond in English. Be concise (2-3 sentences), warm, and deeply knowledgeable about ${data.t}'s culture, history, and traditions. 
If asked about food, reference specific dishes. If asked about history, reference the timeline events.`;
    } else {
      return `${persona} 
CRITICAL FORMATTING: You must respond in this exact format:
[NATIVE]: Your response in ${this.langConfig[culture].native} (2-3 sentences, culturally authentic)
[ENGLISH]: The English translation

Always use these exact bracket tags. Respond first in the native language to honor the culture, then provide the English translation.`;
    }
  },

  parseResponse(text, culture) {
    if (this.isEnglish(culture)) {
      return { native: text, translation: null, isEnglish: true };
    }

    // Parse [NATIVE]: ... [ENGLISH]: ... format
    const nativeMatch = text.match(/\[NATIVE\]:\s*(.+?)(?=\[ENGLISH\]:|$)/s);
    const englishMatch = text.match(/\[ENGLISH\]:\s*(.+)/s);
    
    if (nativeMatch && englishMatch) {
      return {
        native: nativeMatch[1].trim(),
        translation: englishMatch[1].trim(),
        isEnglish: false
      };
    }

    // Fallback: split by common delimiters
    for (const delimiter of ['|||', '---', '\n\n', 'Translation:']) {
      if (text.includes(delimiter)) {
        const parts = text.split(delimiter).map(s => s.trim());
        if (parts.length >= 2) {
          return { native: parts[0], translation: parts[1], isEnglish: false };
        }
      }
    }

    return { native: text, translation: '(Translation unavailable)', isEnglish: false };
  },

  addMessage(culture, text, isUser = false) {
    const container = document.getElementById(`chat-${culture}`);
    if (!container) return;

    const welcome = container.querySelector('.chat-welcome');
    if (welcome) welcome.remove();

    const msgDiv = document.createElement('div');
    msgDiv.className = `chat-message ${isUser ? 'user' : 'ai'}`;
    msgDiv.style.cssText = `margin-bottom:12px;display:flex;flex-direction:column;${isUser ? 'align-items:flex-end' : 'align-items:flex-start'};`;
    
    const bubble = document.createElement('div');
    bubble.style.cssText = `max-width:85%;padding:10px 14px;border-radius:18px;font-size:13px;line-height:1.4;word-wrap:break-word;font-family:'DM Sans',sans-serif;${isUser ? 'background:var(--tts-active);color:#000;border-bottom-right-radius:4px;font-weight:500;' : 'background:var(--stat-bg);color:var(--text);border:1px solid var(--border);border-bottom-left-radius:4px;'}`;
    bubble.textContent = text;
    
    msgDiv.appendChild(bubble);
    container.appendChild(msgDiv);
    container.scrollTop = container.scrollHeight;
  },

  addAIResponse(culture, parsed) {
    const container = document.getElementById(`chat-${culture}`);
    if (!container) return;

    const welcome = container.querySelector('.chat-welcome');
    if (welcome) welcome.remove();

    const msgDiv = document.createElement('div');
    msgDiv.className = 'chat-message ai';
    msgDiv.style.cssText = 'margin-bottom:14px;display:flex;flex-direction:column;align-items:flex-start;gap:6px;';
    
    // Native language bubble
    const nativeBubble = document.createElement('div');
    nativeBubble.style.cssText = 'max-width:85%;padding:12px 16px;border-radius:18px;font-size:13px;line-height:1.5;background:var(--stat-bg);color:var(--text);border:1px solid var(--border);border-bottom-left-radius:4px;position:relative;';
    nativeBubble.innerHTML = `<div style="font-size:9px;text-transform:uppercase;letter-spacing:1px;opacity:0.5;margin-bottom:4px;color:var(--tts-active);font-weight:700;">${this.langConfig[culture].native}</div>${parsed.native}`;
    msgDiv.appendChild(nativeBubble);
    
    // English translation bubble
    if (!parsed.isEnglish && parsed.translation) {
      const transBubble = document.createElement('div');
      transBubble.style.cssText = 'max-width:85%;padding:10px 14px;border-radius:14px;font-size:12px;line-height:1.4;background:rgba(0,0,0,0.15);color:var(--text-dim);border:1px solid var(--border);border-left:3px solid var(--tts-active);font-style:italic;margin-left:8px;';
      transBubble.textContent = parsed.translation;
      msgDiv.appendChild(transBubble);
    }
    
    container.appendChild(msgDiv);
    container.scrollTop = container.scrollHeight;
  },

  showLoading(culture) {
    const container = document.getElementById(`chat-${culture}`);
    if (!container) return;
    
    const loading = document.createElement('div');
    loading.id = `chat-loading-${culture}`;
    loading.style.cssText = 'margin-bottom:12px;display:flex;flex-direction:column;align-items:flex-start;animation:fadeIn 0.3s ease;';
    loading.innerHTML = `
      <div style="padding:12px 18px;border-radius:18px;background:var(--stat-bg);border:1px solid var(--border);border-bottom-left-radius:4px;display:flex;gap:5px;align-items:center;min-width:120px;">
        <span style="width:7px;height:7px;background:var(--tts-active);border-radius:50%;animation:chat-bounce 1.4s infinite ease-in-out both;animation-delay:-0.32s;"></span>
        <span style="width:7px;height:7px;background:var(--tts-active);border-radius:50%;animation:chat-bounce 1.4s infinite ease-in-out both;animation-delay:-0.16s;"></span>
        <span style="width:7px;height:7px;background:var(--tts-active);border-radius:50%;animation:chat-bounce 1.4s infinite ease-in-out both;"></span>
        <span style="font-size:11px;margin-left:6px;opacity:0.6;font-style:italic;">Consulting ${CData[culture].spirit}...</span>
      </div>
    `;
    container.appendChild(loading);
    container.scrollTop = container.scrollHeight;
  },

  hideLoading(culture) {
    const loading = document.getElementById(`chat-loading-${culture}`);
    if (loading) loading.remove();
  }
};

// Main send function
async function sendChatMessage(culture) {
  const input = document.getElementById(`chat-input-${culture}`);
  const text = input.value.trim();
  if (!text) return;
  
  input.value = '';
  CulturalChat.addMessage(culture, text, true);
  CulturalChat.showLoading(culture);
  
  try {
    const systemPrompt = CulturalChat.buildSystemPrompt(culture);
    const encodedPrompt = encodeURIComponent(text);
    const encodedSystem = encodeURIComponent(systemPrompt);
    const seed = Date.now();
    
    const url = `https://text.pollinations.ai/${encodedPrompt}?model=openai&system=${encodedSystem}&seed=${seed}&temperature=0.7&max_tokens=300`;
    
    const response = await fetch(url);
    if (!response.ok) throw new Error('API Error');
    
    const responseText = await response.text();
    CulturalChat.hideLoading(culture);
    
    const parsed = CulturalChat.parseResponse(responseText, culture);
    CulturalChat.addAIResponse(culture, parsed);
    
  } catch (error) {
    console.error('Chat error:', error);
    CulturalChat.hideLoading(culture);
    CulturalChat.addAIResponse(culture, {
      native: 'The connection to the ancient spirits grows faint. Please try again, traveler.',
      translation: 'Connection error. Please retry.',
      isEnglish: false
    });
  }
}

// Initialize all panels
Object.keys(CData).forEach(culture => {
  renderPanel(culture);
});

// ============================================
// VISUAL EFFECTS SYSTEM
// ============================================

class VisualEffectsSystem {
  constructor() {
    this.cursorTrail = null;
    this.tiltElements = [];
    this.magneticElements = [];
    this.init();
  }

  init() {
    this.initCursorTrail();
    this.initTiltEffect();
    this.initMagneticButtons();
    this.initScrollReveal();
    this.initParallax();
    this.initTextDecode();
  }

  // 1. 3D Tilt Effect
  initTiltEffect() {
    const cards = document.querySelectorAll('.card, .food-item');
    cards.forEach(card => {
      card.classList.add('tilt-card');
      card.addEventListener('mousemove', this.handleTilt.bind(this));
      card.addEventListener('mouseleave', this.handleTiltReset.bind(this));
    });
  }

  handleTilt(e) {
    const card = e.currentTarget;
    const rect = card.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    const centerX = rect.width / 2;
    const centerY = rect.height / 2;
    
    const rotateX = (y - centerY) / 20;
    const rotateY = (centerX - x) / 20;
    
    card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
    
    // Update glare position
    const percentX = (x / rect.width) * 100;
    const percentY = (y / rect.height) * 100;
    card.style.setProperty('--glare-x', `${percentX}%`);
    card.style.setProperty('--glare-y', `${percentY}%`);
  }

  handleTiltReset(e) {
    const card = e.currentTarget;
    card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale3d(1, 1, 1)';
  }

  // 2. Scroll Reveal
  initScrollReveal() {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('revealed');
          observer.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });

    document.querySelectorAll('.card, .spirit-box, .timeline li, .food-item, .sec-label').forEach((el, index) => {
      el.classList.add('reveal-element');
      el.classList.add(`reveal-delay-${(index % 5) + 1}`);
      observer.observe(el);
    });
  }

  // 3. Parallax Effect
  initParallax() {
    let ticking = false;
    
    document.querySelectorAll('.panel').forEach(panel => {
      panel.addEventListener('scroll', () => {
        if (!ticking) {
          requestAnimationFrame(() => {
            this.updateParallax(panel);
            ticking = false;
          });
          ticking = true;
        }
      });
    });
  }

  updateParallax(panel) {
    const hero = panel.querySelector('.hero');
    if (!hero) return;
    
    const glyph = hero.querySelector('.hero-bg-glyph');
    const title = hero.querySelector('.hero-title');
    const scrollY = panel.scrollTop;
    
    if (glyph) {
      glyph.style.transform = `translateY(${scrollY * 0.5}px) rotate(${scrollY * 0.05}deg)`;
    }
    if (title) {
      title.style.transform = `translateY(${scrollY * 0.2}px)`;
      title.style.opacity = Math.max(0, 1 - (scrollY / 400));
    }
  }

  // 4. Magnetic Buttons
  initMagneticButtons() {
    const buttons = document.querySelectorAll('.tab-btn, .expand-btn, .quiz-opt, .tts-btn, .speak-btn');
    buttons.forEach(btn => {
      btn.classList.add('magnetic-btn');
      btn.addEventListener('mousemove', this.handleMagnetic.bind(this));
      btn.addEventListener('mouseleave', this.handleMagneticReset.bind(this));
    });
  }

  handleMagnetic(e) {
    const btn = e.currentTarget;
    const rect = btn.getBoundingClientRect();
    const x = e.clientX - rect.left - rect.width / 2;
    const y = e.clientY - rect.top - rect.height / 2;
    
    btn.style.transform = `translate(${x * 0.3}px, ${y * 0.3}px)`;
  }

  handleMagneticReset(e) {
    e.currentTarget.style.transform = 'translate(0, 0)';
  }

  // 5. Cursor Trail
  initCursorTrail() {
    if (window.matchMedia('(pointer: coarse)').matches) return; // Disable on touch
    
    this.cursorTrail = document.createElement('div');
    this.cursorTrail.className = 'cursor-trail';
    document.body.appendChild(this.cursorTrail);
    
    let mouseX = 0, mouseY = 0;
    let trailX = 0, trailY = 0;
    
    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
      this.cursorTrail.style.opacity = '0.6';
      
      // Update color based on active panel
      const activePanel = document.querySelector('.panel.active');
      if (activePanel) {
        const color = getComputedStyle(activePanel).getPropertyValue('--tts-active').trim() || '#fff';
        this.cursorTrail.style.background = color;
        this.cursorTrail.style.boxShadow = `0 0 20px ${color}`;
      }
    });
    
    const animate = () => {
      trailX += (mouseX - trailX) * 0.1;
      trailY += (mouseY - trailY) * 0.1;
      this.cursorTrail.style.left = trailX - 10 + 'px';
      this.cursorTrail.style.top = trailY - 10 + 'px';
      requestAnimationFrame(animate);
    };
    animate();
  }

  // 6. Text Decode Effect
  initTextDecode() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
    
    document.querySelectorAll('.hero-title').forEach(title => {
      const originalText = title.textContent;
      title.addEventListener('mouseenter', () => {
        let iterations = 0;
        const interval = setInterval(() => {
          title.textContent = originalText
            .split('')
            .map((char, index) => {
              if (index < iterations) return originalText[index];
              if (char === ' ') return ' ';
              return chars[Math.floor(Math.random() * chars.length)];
            })
            .join('');
          
          iterations += 1/2;
          if (iterations >= originalText.length) {
            clearInterval(interval);
            title.textContent = originalText;
          }
        }, 30);
      });
    });
  }
}

// Initialize effects when DOM is ready
let visualEffects;
document.addEventListener('DOMContentLoaded', () => {
  visualEffects = new VisualEffectsSystem();
});

// Re-initialize effects when switching tabs
const originalShowTab = window.showTab;
window.showTab = function(id, btn) {
  originalShowTab(id, btn);
  setTimeout(() => {
    if (visualEffects) {
      visualEffects.init();
    }
  }, 150);
};

// ============================================
// NEW BACKGROUND ENHANCEMENTS
// ============================================

class BackgroundEnhancements {
  constructor() {
    this.particleSystems = new Map();
    this.constellationSystems = new Map();
    this.activePanel = null;
    this.init();
  }

  init() {
    this.createBackgroundLayers();
    this.initParticleSystems();
    this.initConstellationNetworks();
    this.initParallaxPlanes();
    this.initTemporalLighting();
    this.startAnimationLoop();
  }

  // 1. CULTURAL PARTICLE ATMOSPHERES
  createBackgroundLayers() {
    document.querySelectorAll('.panel').forEach(panel => {
      const canvas = document.createElement('canvas');
      canvas.className = 'particle-canvas';
      canvas.id = `particles-${panel.id}`;
      panel.insertBefore(canvas, panel.firstChild);
      
      // Add texture layer
      const texture = document.createElement('div');
      texture.className = 'texture-layer';
      panel.insertBefore(texture, panel.firstChild);
      
      // Add temporal lighting overlay
      const lighting = document.createElement('div');
      lighting.className = 'temporal-overlay';
      panel.appendChild(lighting);
    });
  }

  initParticleSystems() {
    const cultureConfigs = {
      'panel-irish': { type: 'celtic', color: '#7fc46e', symbols: ['‚òò', '‚ú¶', '‚óà'] },
      'panel-japanese': { type: 'sakura', color: '#e8a0b5', symbols: ['‚ùÄ', '‚ùÅ', '‚úø'] },
      'panel-egyptian': { type: 'golden', color: '#d4af37', symbols: ['ìÇÄ', '‚ö±', 'üî∫'] },
      'panel-fantasy': { type: 'firefly', color: '#8fbc8f', symbols: ['‚ú¶', '‚Ä¢', '‚óê'] },
      'panel-vulcan': { type: 'geometric', color: '#cd7f32', symbols: ['‚ñ≥', '‚ñ°', '‚óä'] },
      'panel-candy': { type: 'sugar', color: '#ff69b4', symbols: ['‚óÜ', '‚óè', '‚òÖ'] }
    };

    document.querySelectorAll('.panel').forEach(panel => {
      const canvas = document.getElementById(`particles-${panel.id}`);
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      const config = cultureConfigs[panel.id] || { type: 'default', color: '#ffffff', symbols: ['‚Ä¢'] };
      
      this.particleSystems.set(panel.id, {
        canvas,
        ctx,
        particles: [],
        config,
        width: window.innerWidth,
        height: window.innerHeight
      });

      this.createParticles(panel.id, 20);
    });

    window.addEventListener('resize', () => this.handleResize());
  }

  createParticles(panelId, count) {
    const system = this.particleSystems.get(panelId);
    if (!system) return;
    
    const { width, height, config } = system;
    
    for (let i = 0; i < count; i++) {
      system.particles.push({
        x: Math.random() * width,
        y: Math.random() * height,
        size: Math.random() * 3 + 1,
        speedY: Math.random() * 0.5 + 0.1,
        speedX: (Math.random() - 0.5) * 0.2,
        opacity: Math.random() * 0.5 + 0.1,
        symbol: config.symbols[Math.floor(Math.random() * config.symbols.length)],
        rotation: Math.random() * 360,
        rotationSpeed: (Math.random() - 0.5) * 0.02
      });
    }
  }

  // 2. CONSTELLATION CONNECTION NETWORKS
  initConstellationNetworks() {
    document.querySelectorAll('.panel').forEach(panel => {
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.classList.add('constellation-svg');
      svg.id = `constellation-${panel.id}`;
      
      const cultureNodes = this.generateConstellationNodes(panel.id);
      
      cultureNodes.forEach((node, i) => {
        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
        circle.setAttribute('cx', node.x);
        circle.setAttribute('cy', node.y);
        circle.setAttribute('class', 'constellation-node');
        circle.style.animationDelay = `${i * 0.5}s`;
        svg.appendChild(circle);
        
        // Connect to nearby nodes
        cultureNodes.forEach((other, j) => {
          if (i < j && this.distance(node, other) < 200) {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', node.x);
            line.setAttribute('y1', node.y);
            line.setAttribute('x2', other.x);
            line.setAttribute('y2', other.y);
            line.setAttribute('class', 'constellation-line');
            line.style.animationDelay = `${i * 0.3}s`;
            svg.appendChild(line);
          }
        });
      });
      
      panel.insertBefore(svg, panel.firstChild);
      this.constellationSystems.set(panel.id, { svg, nodes: cultureNodes });
    });
  }

  generateConstellationNodes(panelId) {
    const nodes = [];
    const count = 15;
    const width = window.innerWidth;
    const height = window.innerHeight;
    
    // Culture-specific node positioning
    const patterns = {
      'panel-irish': () => ({ x: Math.random() * width, y: Math.random() * height * 0.6 }),
      'panel-egyptian': () => ({ 
        x: (Math.random() * width * 0.8) + (width * 0.1), 
        y: (Math.random() * height * 0.5) + (height * 0.2) 
      }),
      'panel-japanese': () => ({
        x: Math.random() * width,
        y: Math.random() * height * 0.4
      })
    };
    
    const generator = patterns[panelId] || (() => ({ x: Math.random() * width, y: Math.random() * height }));
    
    for (let i = 0; i < count; i++) {
      nodes.push(generator());
    }
    return nodes;
  }

  distance(a, b) {
    return Math.sqrt((a.x - b.x) ** 2 + (a.y - b.y) ** 2);
  }

  // 3. PARALLAX DEPTH PLANES
  initParallaxPlanes() {
    document.querySelectorAll('.hero').forEach(hero => {
      const deep = document.createElement('div');
      deep.className = 'parallax-layer parallax-deep';
      
      const mid = document.createElement('div');
      mid.className = 'parallax-layer parallax-mid';
      
      const near = document.createElement('div');
      near.className = 'parallax-layer parallax-near';
      
      hero.appendChild(deep);
      hero.appendChild(mid);
      hero.appendChild(near);
    });

    // Add scroll listener for parallax
    document.querySelectorAll('.panel').forEach(panel => {
      panel.addEventListener('scroll', (e) => this.updateParallaxPlanes(e.target));
    });
  }

  updateParallaxPlanes(panel) {
    const scrollY = panel.scrollTop;
    const deep = panel.querySelector('.parallax-deep');
    const mid = panel.querySelector('.parallax-mid');
    
    if (deep) deep.style.transform = `translateY(${scrollY * 0.1}px)`;
    if (mid) mid.style.transform = `translateY(${scrollY * 0.3}px)`;
  }

  // 4. TEMPORAL LIGHTING SHIFTS
  initTemporalLighting() {
    // Sync with local time for realistic lighting
    const hour = new Date().getHours();
    
    document.querySelectorAll('.panel').forEach(panel => {
      const overlay = panel.querySelector('.temporal-overlay');
      if (!overlay) return;
      
      // Adjust intensity based on time of day
      let intensity = 0.3;
      if (hour >= 6 && hour < 12) intensity = 0.2; // Morning
      else if (hour >= 12 && hour < 17) intensity = 0.4; // Afternoon
      else if (hour >= 17 && hour < 20) intensity = 0.5; // Evening
      else intensity = 0.15; // Night
      
      overlay.style.opacity = intensity;
    });
  }

  // Animation Loop
  startAnimationLoop() {
    const animate = () => {
      this.updateParticles();
      requestAnimationFrame(animate);
    };
    animate();
  }

  updateParticles() {
    const activePanel = document.querySelector('.panel.active');
    if (!activePanel) return;
    
    const system = this.particleSystems.get(activePanel.id);
    if (!system) return;
    
    const { ctx, canvas, particles, config } = system;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    particles.forEach(p => {
      // Update position
      p.y -= p.speedY;
      p.x += p.speedX;
      p.rotation += p.rotationSpeed;
      
      // Reset if off screen
      if (p.y < -10) {
        p.y = canvas.height + 10;
        p.x = Math.random() * canvas.width;
      }
      
      // Draw
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rotation);
      ctx.fillStyle = config.color;
      ctx.globalAlpha = p.opacity;
      ctx.font = `${p.size * 4}px serif`;
      ctx.fillText(p.symbol, 0, 0);
      ctx.restore();
    });
  }

  handleResize() {
    this.particleSystems.forEach((system, panelId) => {
      const canvas = system.canvas;
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      system.width = window.innerWidth;
      system.height = window.innerHeight;
    });
  }
}

// Initialize background enhancements
let bgEnhancements;
document.addEventListener('DOMContentLoaded', () => {
  bgEnhancements = new BackgroundEnhancements();
});

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js')
    .then(() => console.log("TERRA PWA Active"))
    .catch(err => console.log("SW Registration Failed", err));
}
</script>
</body>
</html>
